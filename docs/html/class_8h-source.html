<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>class.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>class.h</h1><div class="fragment"><pre>00001 <span class="comment">//-&lt; CLASS.H &gt;-------------------------------------------------------*--------*</span>
00002 <span class="comment">// FastDB                    Version 1.0         (c) 1999  GARRET    *     ?  *</span>
00003 <span class="comment">// (Main Memory Database Management System)                          *   /\|  *</span>
00004 <span class="comment">//                                                                   *  /  \  *</span>
00005 <span class="comment">//                          Created:     20-Nov-98    K.A. Knizhnik  * / [] \ *</span>
00006 <span class="comment">//                          Last update: 10-Dec-98    K.A. Knizhnik  * GARRET *</span>
00007 <span class="comment">//-------------------------------------------------------------------*--------*</span>
00008 <span class="comment">// Metaclass information</span>
00009 <span class="comment">//-------------------------------------------------------------------*--------*</span>
00010 
00011 <span class="preprocessor">#ifndef __CLASS_H__</span>
00012 <span class="preprocessor"></span><span class="preprocessor">#define __CLASS_H__</span>
00013 <span class="preprocessor"></span>
00014 <span class="preprocessor">#include "stdtp.h"</span>
00015 <span class="preprocessor">#include "sync.h"</span>
00016 <span class="preprocessor">#include "rectangle.h"</span>
00017 
00018 <span class="preprocessor">#ifdef USE_STD_STRING</span>
00019 <span class="preprocessor"></span><span class="preprocessor">#include &lt;string&gt;</span>
00020 <span class="preprocessor">#endif</span>
00021 <span class="preprocessor"></span>
00022 BEGIN_FASTDB_NAMESPACE
00023 
00024 <span class="preprocessor">#ifndef dbDatabaseOffsetBits </span>
00025 <span class="preprocessor"></span><span class="preprocessor">#define dbDatabaseOffsetBits 32</span>
00026 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00027 <span class="preprocessor"></span>
00028 <span class="preprocessor">#ifndef dbDatabaseOidBits </span>
00029 <span class="preprocessor"></span><span class="preprocessor">#define dbDatabaseOidBits 32</span>
00030 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00031 <span class="preprocessor"></span>
00035 <span class="preprocessor">#if dbDatabaseOidBits &gt; 32</span>
00036 <span class="preprocessor"></span><span class="keyword">typedef</span> size_t oid_t;  <span class="comment">// It will work only for 64-bit OS</span>
00037 <span class="preprocessor">#else</span>
00038 <span class="preprocessor"></span><span class="keyword">typedef</span> nat4 oid_t;
00039 <span class="preprocessor">#endif</span>
00040 <span class="preprocessor"></span>
00044 <span class="preprocessor">#if dbDatabaseOffsetBits &gt; 32</span>
00045 <span class="preprocessor"></span><span class="keyword">typedef</span> size_t offs_t; <span class="comment">// It will work only for 64-bit OS</span>
00046 <span class="preprocessor">#else</span>
00047 <span class="preprocessor"></span><span class="keyword">typedef</span> nat4 offs_t;
00048 <span class="preprocessor">#endif</span>
00049 <span class="preprocessor"></span>
00053 <span class="keyword">enum</span> dbIndexType { 
00054     HASHED  = 1,                   <span class="comment">// hash table</span>
00055     INDEXED = 2,                   <span class="comment">// T-tree</span>
00056 
00057     DB_FIELD_CASCADE_DELETE = 8,   <span class="comment">// Used by OWNER macro, do not set it explicitly</span>
00058 
00059     AUTOINCREMENT = 16,            <span class="comment">// field is assigned automaticall incremented value</span>
00060 
00061     DB_TIMESTAMP = 256,            <span class="comment">// field is used as timestamp (this flag is used by CLI to perfrom proper mapping,</span>
00062                                    <span class="comment">// it is not used by C++ API)</span>
00063     DB_FIELD_INHERITED_MASK = ~(HASHED|INDEXED)
00064 };
00065 
00066 
00070 <span class="preprocessor">#define KEY(x, index) \</span>
00071 <span class="preprocessor">    *FASTDB_NS::dbDescribeField(new FASTDB_NS::dbFieldDescriptor(#x, (char*)&amp;x-(char*)this, \</span>
00072 <span class="preprocessor">                                                                 sizeof(x), index), x)</span>
00073 <span class="preprocessor"></span>
00077 <span class="preprocessor">#define FIELD(x) KEY(x, 0)</span>
00078 <span class="preprocessor"></span>
00082 <span class="keyword">typedef</span> int (*dbUDTComparator)(<span class="keywordtype">void</span>*, <span class="keywordtype">void</span>*, size_t);
00083 
00087 <span class="preprocessor">#define UDT(x, index, comparator) \</span>
00088 <span class="preprocessor">    *FASTDB_NS::dbDescribeRawField(new FASTDB_NS::dbFieldDescriptor(#x, (char*)&amp;x-(char*)this, \</span>
00089 <span class="preprocessor">                                                                    sizeof(x), index), (dbUDTComparator)comparator)</span>
00090 <span class="preprocessor"></span>
00094 <span class="preprocessor">#define RAWFIELD(x) UDT(x, 0, &amp;memcmp)</span>
00095 <span class="preprocessor"></span>
00099 <span class="preprocessor">#define RAWKEY(x, index) UDT(x, index, &amp;memcmp)</span>
00100 <span class="preprocessor"></span>
00106 <span class="preprocessor">#define RELATION(x,inverse) \</span>
00107 <span class="preprocessor">    *FASTDB_NS::dbDescribeField(new FASTDB_NS::dbFieldDescriptor(#x, (char*)&amp;x-(char*)this, \</span>
00108 <span class="preprocessor">                                                                 sizeof(x), 0, #inverse), x)</span>
00109 <span class="preprocessor"></span>
00115 <span class="preprocessor">#define INDEXED_RELATION(x,inverse) \</span>
00116 <span class="preprocessor">    *FASTDB_NS::dbDescribeField(new FASTDB_NS::dbFieldDescriptor(#x, (char*)&amp;x-(char*)this, \</span>
00117 <span class="preprocessor">                                                                 sizeof(x), FASTDB_NS::INDEXED, #inverse), x)</span>
00118 <span class="preprocessor"></span> 
00119 
00125 <span class="preprocessor">#define OWNER(x,member) \</span>
00126 <span class="preprocessor">    *FASTDB_NS::dbDescribeField(new FASTDB_NS::dbFieldDescriptor(#x, (char*)&amp;x-(char*)this, \</span>
00127 <span class="preprocessor">                                           sizeof(x), FASTDB_NS::DB_FIELD_CASCADE_DELETE, \</span>
00128 <span class="preprocessor">                                           #member), x)</span>
00129 <span class="preprocessor"></span>
00132 <span class="preprocessor">#define METHOD(x) \</span>
00133 <span class="preprocessor">    *FASTDB_NS::dbDescribeMethod(new FASTDB_NS::dbFieldDescriptor(#x), &amp;self::x)</span>
00134 <span class="preprocessor"></span>
00138 <span class="preprocessor">#define SUPERCLASS(x) \</span>
00139 <span class="preprocessor">    x::dbDescribeComponents(NULL)-&gt;adjustOffsets((char*)((x*)this)-(char*)this)</span>
00140 <span class="preprocessor"></span>
00145 <span class="preprocessor">#define TYPE_DESCRIPTOR(fields) \</span>
00146 <span class="preprocessor">    FASTDB_NS::dbFieldDescriptor* dbDescribeComponents(FASTDB_NS::dbFieldDescriptor*) { \</span>
00147 <span class="preprocessor">        return &amp;fields; \</span>
00148 <span class="preprocessor">    } \</span>
00149 <span class="preprocessor">    static FASTDB_NS::dbTableDescriptor dbDescriptor </span>
00150 <span class="preprocessor"></span>
00151 
00157 <span class="preprocessor">#define CLASS_DESCRIPTOR(name, fields) \</span>
00158 <span class="preprocessor">    typedef name self; \</span>
00159 <span class="preprocessor">    FASTDB_NS::dbFieldDescriptor* dbDescribeComponents(FASTDB_NS::dbFieldDescriptor*) { \</span>
00160 <span class="preprocessor">        return &amp;fields; \</span>
00161 <span class="preprocessor">    } \</span>
00162 <span class="preprocessor">    static FASTDB_NS::dbTableDescriptor dbDescriptor </span>
00163 <span class="preprocessor"></span>
00167 <span class="preprocessor">#define REGISTER_IN(table, database) \</span>
00168 <span class="preprocessor">    FASTDB_NS::dbTableDescriptor* dbGetTableDescriptor(table*) \</span>
00169 <span class="preprocessor">      { return &amp;table::dbDescriptor; }            \</span>
00170 <span class="preprocessor">    static FASTDB_NS::dbFieldDescriptor* dbDescribeComponentsOf##table() \</span>
00171 <span class="preprocessor">      { return ((table*)0)-&gt;dbDescribeComponents(NULL); }     \</span>
00172 <span class="preprocessor">    FASTDB_NS::dbTableDescriptor table::dbDescriptor(#table, database, sizeof(table), \</span>
00173 <span class="preprocessor">                                          &amp;dbDescribeComponentsOf##table)</span>
00174 <span class="preprocessor"></span>
00179 <span class="preprocessor">#define REGISTER(table) REGISTER_IN(table, NULL)</span>
00180 <span class="preprocessor"></span>
00185 <span class="preprocessor">#define DETACHED_TABLE ((FASTDB_NS::dbDatabase*)-1)</span>
00186 <span class="preprocessor"></span><span class="preprocessor">#define REGISTER_UNASSIGNED(table) REGISTER_IN(table, DETACHED_TABLE)</span>
00187 <span class="preprocessor"></span>
00188 
00189 <span class="keyword">class </span><a class="code" href="classdbTable.html">dbTable</a>;
00190 <span class="keyword">class </span><a class="code" href="classdbDatabase.html">dbDatabase</a>;
00191 <span class="keyword">class </span><a class="code" href="classdbAnyArray.html">dbAnyArray</a>;
00192 <span class="keyword">class </span><a class="code" href="classdbTableDescriptor.html">dbTableDescriptor</a>;
00193 <span class="keyword">class </span><a class="code" href="classdbAnyMethodTrampoline.html">dbAnyMethodTrampoline</a>;
00194 
<a name="l00198"></a><a class="code" href="classdbFieldDescriptor.html">00198</a> <span class="keyword">class </span>FASTDB_DLL_ENTRY <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a> { 
00199   <span class="keyword">public</span>:
<a name="l00203"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm0">00203</a>     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* next;
<a name="l00207"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm1">00207</a>     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* prev;
00208 
<a name="l00212"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm2">00212</a>     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* nextField;
00213     
<a name="l00217"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm3">00217</a>     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* nextHashedField;
00218 
<a name="l00222"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm4">00222</a>     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* nextIndexedField;
00223 
<a name="l00227"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm5">00227</a>     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* nextInverseField;
00228 
<a name="l00232"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm6">00232</a>     <span class="keywordtype">int</span>                fieldNo;
00233     
<a name="l00237"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm7">00237</a>     <span class="keywordtype">char</span>*              name;
00238 
<a name="l00242"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm8">00242</a>     <span class="keywordtype">char</span>*              longName;
00243 
<a name="l00247"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm9">00247</a>     <span class="keywordtype">char</span>*              refTableName;
00248 
<a name="l00252"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm10">00252</a>     <a class="code" href="classdbTableDescriptor.html">dbTableDescriptor</a>* refTable;
00253 
<a name="l00257"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm11">00257</a>     <a class="code" href="classdbTableDescriptor.html">dbTableDescriptor</a>* defTable;
00258 
<a name="l00262"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm12">00262</a>     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* inverseRef;
00263 
<a name="l00267"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm13">00267</a>     <span class="keywordtype">char</span>*              inverseRefName;  
00268 
<a name="l00272"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">00272</a>     <span class="keywordtype">int</span>                type;
00273 
<a name="l00277"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm15">00277</a>     <span class="keywordtype">int</span>                appType;
00278 
<a name="l00282"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm16">00282</a>     <span class="keywordtype">int</span>                indexType;
00283 
<a name="l00287"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm17">00287</a>     <span class="keywordtype">int</span>                dbsOffs;
00288 
<a name="l00292"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm18">00292</a>     <span class="keywordtype">int</span>                appOffs;
00293 
<a name="l00297"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm19">00297</a>     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* components;
00298     
<a name="l00302"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm20">00302</a>     oid_t              hashTable;
00303 
<a name="l00307"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm21">00307</a>     oid_t              tTree;
00308 
<a name="l00312"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm22">00312</a>     size_t             dbsSize;
00313     
<a name="l00317"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm23">00317</a>     size_t             appSize;
00318 
<a name="l00323"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm24">00323</a>     size_t             alignment;
00324 
<a name="l00328"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm25">00328</a>     dbUDTComparator    comparator;
00329 
<a name="l00333"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptors7">00333</a>     <span class="keyword">enum</span> FieldAttributes { 
00334         ComponentOfArray   = 0x01,
00335         HasArrayComponents = 0x02,
00336         OneToOneMapping    = 0x04,
00337         Updated            = 0x08
00338     };
00339     <span class="keywordtype">int</span>                attr;
00340 
<a name="l00344"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm27">00344</a>     <span class="keywordtype">int</span>                oldDbsType;
<a name="l00348"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm28">00348</a>     <span class="keywordtype">int</span>                oldDbsOffs;
<a name="l00352"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm29">00352</a>     <span class="keywordtype">int</span>                oldDbsSize;
00353 
<a name="l00357"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm30">00357</a>     <a class="code" href="classdbAnyMethodTrampoline.html">dbAnyMethodTrampoline</a>* method;
00358 
00362     void (*arrayAllocator)(<a class="code" href="classdbAnyArray.html">dbAnyArray</a>* array, <span class="keywordtype">void</span>* data, size_t length);
00363     
00364 
00375     size_t calculateRecordSize(byte* base, size_t offs);
00376 
00386     size_t calculateNewRecordSize(byte* base, size_t offs);
00387     
00397     size_t convertRecord(byte* dst, byte* src, size_t offs);
00398 
00409     <span class="keywordtype">int</span>    sizeWithoutOneField(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* field, 
00410                                byte* base, size_t&amp; size);
00411     
00421     size_t copyRecordExceptOneField(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* field, 
00422                                     byte* dst, byte* src, size_t offs); 
00423 
00424     <span class="keyword">enum</span> StoreMode {
00425         Insert,
00426         Update,
00427         Import
00428     };
00429 
00440     size_t storeRecordFields(byte* dst, byte* src, size_t offs, StoreMode mode);
00441 
00449     <span class="keywordtype">void</span> markUpdatedFields(byte* dst, byte* src);
00450 
00458     <span class="keywordtype">void</span> fetchRecordFields(byte* dst, byte* src);
00459 
00468     <span class="keywordtype">void</span> adjustReferences(byte* record, size_t base, size_t size, <span class="keywordtype">long</span> shift);
00469 
00475     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* find(<span class="keyword">const</span> <span class="keywordtype">char</span>* name);
00476 
<a name="l00481"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptora10">00481</a>     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* getFirstComponent() { 
00482         <span class="keywordflow">return</span> components;
00483     }
00484 
<a name="l00489"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptora11">00489</a>     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* getNextComponent(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* field) { 
00490         <span class="keywordflow">if</span> (field != NULL) { 
00491             field = field-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm0">next</a>;
00492             <span class="keywordflow">if</span> (field == components) { 
00493                 <span class="keywordflow">return</span> NULL;
00494             }
00495         }
00496         <span class="keywordflow">return</span> field;
00497     }
00498         
<a name="l00502"></a><a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptora12">00502</a>     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>&amp; operator, (<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>&amp; field) { 
00503         <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* tail = field.<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm1">prev</a>;
00504         tail-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm0">next</a> = <span class="keyword">this</span>;
00505         prev-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm0">next</a> = &amp;field;
00506         field.<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm1">prev</a> = prev;
00507         prev = tail;
00508         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00509     }
00510 
00511     <span class="keywordtype">void</span>* operator new(size_t size EXTRA_DEBUG_NEW_PARAMS);
00512     <span class="keywordtype">void</span>  operator delete(<span class="keywordtype">void</span>* p EXTRA_DEBUG_NEW_PARAMS);
00513 
00517     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>&amp; adjustOffsets(<span class="keywordtype">long</span> offs);
00518 
00528     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>(<span class="keywordtype">char</span> <span class="keyword">const</span>* name, size_t offs, size_t size, <span class="keywordtype">int</span> indexType, 
00529                       <span class="keywordtype">char</span> <span class="keyword">const</span>* inverse = NULL,
00530                       <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* components = NULL);
00531 
00536     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>(<span class="keywordtype">char</span> <span class="keyword">const</span>* name);
00537 
00541     ~<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>();
00542 };
00543 
00544 
<a name="l00548"></a><a class="code" href="classdbTableDescriptor.html">00548</a> <span class="keyword">class </span>FASTDB_DLL_ENTRY dbTableDescriptor { 
00549     <span class="keyword">friend</span> <span class="keyword">class </span>dbCompiler;
00550     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classdbDatabase.html">dbDatabase</a>;
00551     <span class="keyword">friend</span> <span class="keyword">class </span>dbReplicatedDatabase;
00552     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classdbTable.html">dbTable</a>;
00553     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classdbAnyCursor.html">dbAnyCursor</a>;
00554     <span class="keyword">friend</span> <span class="keyword">class </span>dbSubSql;
00555     <span class="keyword">friend</span> <span class="keyword">class </span>dbHashTable;
00556     <span class="keyword">friend</span> <span class="keyword">class </span>dbTtreeNode;
00557     <span class="keyword">friend</span> <span class="keyword">class </span>dbRtreePage;
00558     <span class="keyword">friend</span> <span class="keyword">class </span>dbServer;
00559     <span class="keyword">friend</span> <span class="keyword">class </span>dbColumnBinding;
00560     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>;
00561     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classdbAnyContainer.html">dbAnyContainer</a>;
00562     <span class="keyword">friend</span> <span class="keyword">class </span>dbCLI;
00563     <span class="keyword">friend</span> <span class="keyword">class </span>dbSelection;
00564   <span class="keyword">protected</span>:
<a name="l00568"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptorn0">00568</a>     dbTableDescriptor*  next;
00569     <span class="keyword">static</span> dbTableDescriptor* chain;
00570 
<a name="l00574"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptorn1">00574</a>     dbTableDescriptor*  nextDbTable; <span class="comment">// next table in the database</span>
00575 
<a name="l00579"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptorn2">00579</a>     <span class="keywordtype">char</span>*               name;
00580 
<a name="l00584"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptorn3">00584</a>     oid_t               tableId;
00585 
<a name="l00589"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptorn4">00589</a>     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>*  columns; 
00590     
<a name="l00594"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptorn5">00594</a>     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>*  hashedFields;
00595 
<a name="l00599"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptorn6">00599</a>     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>*  indexedFields;
00600 
<a name="l00604"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptorn7">00604</a>     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>*  inverseFields;
00605 
<a name="l00609"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptorn8">00609</a>     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>*  firstField;
00610 
<a name="l00614"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptorn9">00614</a>     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>** nextFieldLink;
00615 
<a name="l00619"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptorn10">00619</a>     <a class="code" href="classdbDatabase.html">dbDatabase</a>*         db;
00620     
<a name="l00624"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptorn11">00624</a>     <span class="keywordtype">bool</span>                fixedDatabase;
00625 
<a name="l00629"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptorn12">00629</a>     <span class="keywordtype">bool</span>                isStatic;
00630 
<a name="l00634"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptorn13">00634</a>     size_t              appSize;
00635 
<a name="l00639"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptorn14">00639</a>     size_t              fixedSize;
00640 
<a name="l00644"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptorn15">00644</a>     size_t              nFields;
00645 
<a name="l00649"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptorn16">00649</a>     size_t              nColumns;
00650 
<a name="l00654"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptorn17">00654</a>     int4                autoincrementCount;
00655 
00656 
<a name="l00662"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptorn18">00662</a>     dbTableDescriptor*  cloneOf;
00663 
00664 
<a name="l00668"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptort0">00668</a>     <span class="keyword">typedef</span> <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* (*describeFunc)();
00669     describeFunc        describeComponentsFunc;
00670 
<a name="l00674"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptorn20">00674</a>     dbTableDescriptor* collisionChain;
00675 
00679     dbTableDescriptor*  clone();
00680 
00684     size_t              totalNamesLength();
00685 
00697     <span class="keywordtype">int</span> calculateFieldsAttributes(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* fieldsList, 
00698                                   <span class="keywordtype">char</span> <span class="keyword">const</span>* prefix, <span class="keywordtype">int</span> offs, 
00699                                   <span class="keywordtype">int</span> indexMask, <span class="keywordtype">int</span>&amp; attr);
00700 
00709     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* buildFieldsList(<a class="code" href="classdbTable.html">dbTable</a>* table, <span class="keywordtype">char</span> <span class="keyword">const</span>* prefix, <span class="keywordtype">int</span> prefixLen, <span class="keywordtype">int</span>&amp; attr);
00710 
00711   <span class="keyword">public</span>:
<a name="l00716"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptorp0">00716</a>     <span class="keyword">static</span> <span class="keywordtype">int</span> initialAutoincrementCount;
00717 
<a name="l00721"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptora0">00721</a>     dbTableDescriptor* getNextTable() { 
00722         <span class="keywordflow">return</span> nextDbTable;
00723     }
00724 
00728     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* findSymbol(<span class="keywordtype">char</span> <span class="keyword">const</span>* name);
00729 
00730 
00734     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* find(<span class="keywordtype">char</span> <span class="keyword">const</span>* name);
00735 
00736 
<a name="l00741"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptora3">00741</a>     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* getFirstField() { 
00742         <span class="keywordflow">return</span> columns;
00743     }
00744 
<a name="l00749"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptora4">00749</a>     <span class="keywordtype">int</span> getLastValueOfAutoincrementCount()<span class="keyword"> const </span>{ 
00750         <span class="keywordflow">return</span> autoincrementCount;
00751     }
00752 
<a name="l00758"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptora5">00758</a>     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* getNextField(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* field) { 
00759         <span class="keywordflow">if</span> (field != NULL) { 
00760             field = field-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm0">next</a>;
00761             <span class="keywordflow">if</span> (field == columns) { 
00762                 <span class="keywordflow">return</span> NULL;
00763             }
00764         }
00765         <span class="keywordflow">return</span> field;
00766     }
00767 
<a name="l00771"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptora6">00771</a>     <span class="keywordtype">char</span>* getName() { 
00772         <span class="keywordflow">return</span> name;
00773     }
00774 
<a name="l00778"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptora7">00778</a>     size_t size() { 
00779         <span class="keywordflow">return</span> appSize;
00780     }
00781 
00786     <span class="keywordtype">void</span> setFlags();
00787 
00794     <span class="keywordtype">bool</span> equal(<a class="code" href="classdbTable.html">dbTable</a>* table);
00795 
00804     <span class="keywordtype">bool</span> match(<a class="code" href="classdbTable.html">dbTable</a>* table, <span class="keywordtype">bool</span> confirmDeleteColumns);
00805 
00811     <span class="keywordtype">void</span> checkRelationship();
00812 
<a name="l00817"></a><a class="code" href="classdbTableDescriptor.html#dbTableDescriptora12">00817</a>     <a class="code" href="classdbDatabase.html">dbDatabase</a>* getDatabase() { 
00818         assert(db != DETACHED_TABLE);
00819         <span class="keywordflow">return</span> db; 
00820     }
00821 
00826     <span class="keywordtype">void</span> storeInDatabase(<a class="code" href="classdbTable.html">dbTable</a>* table);
00827 
00831     <span class="keyword">static</span> <span class="keywordtype">void</span> cleanup();
00832 
00837     dbTableDescriptor(<a class="code" href="classdbTable.html">dbTable</a>* table);
00838 
00847     dbTableDescriptor(<span class="keywordtype">char</span> <span class="keyword">const</span>* tableName, <a class="code" href="classdbDatabase.html">dbDatabase</a>* db, size_t objSize, 
00848                       describeFunc func, dbTableDescriptor* original = NULL);
00849 
00853     ~dbTableDescriptor();
00854 };
00855 
<a name="l00859"></a><a class="code" href="structdbVarying.html">00859</a> <span class="keyword">struct </span><a class="code" href="structdbVarying.html">dbVarying</a> { 
00860     nat4 size; <span class="comment">// number of elements in the array</span>
00861     int4 offs; <span class="comment">// offset from the beginning of the record</span>
00862 };
00863 
<a name="l00867"></a><a class="code" href="structdbField.html">00867</a> <span class="keyword">struct </span><a class="code" href="structdbField.html">dbField</a> { 
00868     <span class="keyword">enum</span> FieldTypes { 
00869         tpBool,
00870         tpInt1,
00871         tpInt2,
00872         tpInt4,
00873         tpInt8,
00874         tpReal4, 
00875         tpReal8, 
00876         tpString,
00877         tpReference,
00878         tpArray,
00879         tpMethodBool,
00880         tpMethodInt1,
00881         tpMethodInt2,
00882         tpMethodInt4,
00883         tpMethodInt8,
00884         tpMethodReal4,
00885         tpMethodReal8,
00886         tpMethodString,
00887         tpMethodReference,
00888         tpStructure,
00889         tpRawBinary, 
00890         tpStdString,
00891         tpRectangle,
00892         tpUnknown
00893     };
00894         
<a name="l00898"></a><a class="code" href="structdbField.html#dbFieldm0">00898</a>     <a class="code" href="structdbVarying.html">dbVarying</a> <a class="code" href="structdbField.html#dbFieldm0">name</a>;    
00899 
<a name="l00903"></a><a class="code" href="structdbField.html#dbFieldm1">00903</a>     <a class="code" href="structdbVarying.html">dbVarying</a> <a class="code" href="structdbField.html#dbFieldm1">tableName</a>; 
00904 
<a name="l00908"></a><a class="code" href="structdbField.html#dbFieldm2">00908</a>     <a class="code" href="structdbVarying.html">dbVarying</a> <a class="code" href="structdbField.html#dbFieldm2">inverse</a>; 
00909     
00913 <span class="preprocessor">#ifdef OLD_FIELD_DESCRIPTOR_FORMAT</span>
00914 <span class="preprocessor"></span>    int4      <a class="code" href="structdbField.html#dbFieldm3">type</a>;
00915 <span class="preprocessor">#else </span>
00916 <span class="preprocessor"></span><span class="preprocessor">#if BYTE_ORDER == BIG_ENDIAN</span>
00917 <span class="preprocessor"></span>    int4      flags : 24;
00918     int4      <a class="code" href="structdbField.html#dbFieldm3">type</a>  : 8;
00919 <span class="preprocessor">#else</span>
<a name="l00920"></a><a class="code" href="structdbField.html#dbFieldm3">00920</a> <span class="preprocessor"></span>    int4      <a class="code" href="structdbField.html#dbFieldm3">type</a>  : 8;
00921     int4      flags : 24;
00922 <span class="preprocessor">#endif</span>
00923 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00924 <span class="preprocessor"></span>
<a name="l00928"></a><a class="code" href="structdbField.html#dbFieldm5">00928</a>     int4      <a class="code" href="structdbField.html#dbFieldm5">offset</a>; 
00929 
<a name="l00933"></a><a class="code" href="structdbField.html#dbFieldm6">00933</a>     nat4      <a class="code" href="structdbField.html#dbFieldm6">size</a>;
00934 
<a name="l00938"></a><a class="code" href="structdbField.html#dbFieldm7">00938</a>     oid_t     <a class="code" href="structdbField.html#dbFieldm7">hashTable</a>;
00939 
<a name="l00943"></a><a class="code" href="structdbField.html#dbFieldm8">00943</a>     oid_t     <a class="code" href="structdbField.html#dbFieldm8">tTree</a>;
00944 };     
00945 
00946 
<a name="l00950"></a><a class="code" href="classdbRecord.html">00950</a> <span class="keyword">class </span><a class="code" href="classdbRecord.html">dbRecord</a> { 
00951   <span class="keyword">public</span>:
<a name="l00955"></a><a class="code" href="classdbRecord.html#dbTablem8">00955</a>     nat4   <a class="code" href="classdbRecord.html#dbTablem8">size</a>;
00956 
<a name="l00960"></a><a class="code" href="classdbRecord.html#dbTablem9">00960</a>     oid_t  <a class="code" href="classdbRecord.html#dbTablem9">next</a>;
00961 
<a name="l00965"></a><a class="code" href="classdbRecord.html#dbTablem10">00965</a>     oid_t  <a class="code" href="classdbRecord.html#dbTablem10">prev</a>;
00966 };
00967 
00968 
<a name="l00972"></a><a class="code" href="classdbTable.html">00972</a> <span class="keyword">class </span><a class="code" href="classdbTable.html">dbTable</a> : <span class="keyword">public</span> <a class="code" href="classdbRecord.html">dbRecord</a> { 
00973   <span class="keyword">public</span>:
<a name="l00977"></a><a class="code" href="classdbTable.html#dbTablem0">00977</a>     <a class="code" href="structdbVarying.html">dbVarying</a> <a class="code" href="classdbTable.html#dbTablem0">name</a>;
00978     
<a name="l00982"></a><a class="code" href="classdbTable.html#dbTablem1">00982</a>     <a class="code" href="structdbVarying.html">dbVarying</a> <a class="code" href="classdbTable.html#dbTablem1">fields</a>;
00983 
<a name="l00987"></a><a class="code" href="classdbTable.html#dbTablem2">00987</a>     nat4      <a class="code" href="classdbTable.html#dbTablem2">fixedSize</a>;
00988 
<a name="l00992"></a><a class="code" href="classdbTable.html#dbTablem3">00992</a>     nat4      <a class="code" href="classdbTable.html#dbTablem3">nRows</a>;
00993 
<a name="l00997"></a><a class="code" href="classdbTable.html#dbTablem4">00997</a>     nat4      <a class="code" href="classdbTable.html#dbTablem4">nColumns</a>;
00998     
<a name="l01002"></a><a class="code" href="classdbTable.html#dbTablem5">01002</a>     oid_t     <a class="code" href="classdbTable.html#dbTablem5">firstRow</a>;
01003 
<a name="l01007"></a><a class="code" href="classdbTable.html#dbTablem6">01007</a>     oid_t     <a class="code" href="classdbTable.html#dbTablem6">lastRow</a>;
01008 <span class="preprocessor">#ifdef AUTOINCREMENT_SUPPORT</span>
01009 <span class="preprocessor"></span>
<a name="l01012"></a><a class="code" href="classdbTable.html#dbTablem7">01012</a>     nat4      <a class="code" href="classdbTable.html#dbTablem7">count</a>;
01013 <span class="preprocessor">#endif</span>
01014 <span class="preprocessor"></span>};
01015 
01016 <span class="keyword">inline</span> <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* dbDescribeRawField(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* fd, dbUDTComparator comparator)
01017 {
01018     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">type</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm15">appType</a> = dbField::tpRawBinary;
01019     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm24">alignment</a> = 1;
01020     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm25">comparator</a> = comparator;
01021     <span class="keywordflow">return</span> fd;
01022 }
01023 
01024 
01025 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
01026 <span class="keyword">inline</span> <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* dbDescribeField(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* fd, T&amp; x) 
01027 { 
01028     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">type</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm15">appType</a> = dbField::tpStructure;
01029     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm19">components</a> = x.dbDescribeComponents(fd);
01030     <span class="keywordflow">return</span> fd;
01031 }
01032 
01033 <span class="keyword">inline</span> <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* dbDescribeField(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* fd, int1&amp;) 
01034 { 
01035     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">type</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm15">appType</a> = dbField::tpInt1; 
01036     <span class="keywordflow">return</span> fd;
01037 }
01038 <span class="keyword">inline</span> <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* dbDescribeField(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* fd, int2&amp;) 
01039 { 
01040     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">type</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm15">appType</a> = dbField::tpInt2; 
01041     <span class="keywordflow">return</span> fd;
01042 }
01043 <span class="keyword">inline</span> <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* dbDescribeField(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* fd, int4&amp;) 
01044 { 
01045     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">type</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm15">appType</a> = dbField::tpInt4; 
01046     <span class="keywordflow">return</span> fd;
01047 }
01048 <span class="keyword">inline</span> <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* dbDescribeField(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* fd, db_int8&amp;) 
01049 { 
01050     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">type</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm15">appType</a> = dbField::tpInt8; 
01051     <span class="keywordflow">return</span> fd;
01052 }
01053 <span class="keyword">inline</span> <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* dbDescribeField(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* fd, nat1&amp;) 
01054 { 
01055     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">type</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm15">appType</a> = dbField::tpInt1; 
01056     <span class="keywordflow">return</span> fd;
01057 }
01058 <span class="keyword">inline</span> <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* dbDescribeField(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* fd, nat2&amp;) 
01059 { 
01060     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">type</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm15">appType</a> = dbField::tpInt2; 
01061     <span class="keywordflow">return</span> fd;
01062 }
01063 <span class="keyword">inline</span> <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* dbDescribeField(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* fd, nat4&amp;) 
01064 { 
01065     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">type</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm15">appType</a> = dbField::tpInt4; 
01066     <span class="keywordflow">return</span> fd;
01067 }
01068 <span class="keyword">inline</span> <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* dbDescribeField(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* fd, nat8&amp;) 
01069 { 
01070     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">type</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm15">appType</a> = dbField::tpInt8; 
01071     <span class="keywordflow">return</span> fd;
01072 }
01073 <span class="preprocessor">#if SIZEOF_LONG != 8</span>
01074 <span class="preprocessor"></span><span class="keyword">inline</span> <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* dbDescribeField(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* fd, <span class="keywordtype">long</span>&amp;)
01075 {
01076     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">type</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm15">appType</a> = dbField::tpInt4;
01077     <span class="keywordflow">return</span> fd;
01078 }
01079 <span class="keyword">inline</span> <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* dbDescribeField(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* fd, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>&amp;)
01080 {
01081     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">type</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm15">appType</a> = dbField::tpInt4;
01082     <span class="keywordflow">return</span> fd;
01083 }
01084 <span class="preprocessor">#endif</span>
01085 <span class="preprocessor"></span><span class="keyword">inline</span> <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* dbDescribeField(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* fd, <span class="keywordtype">bool</span>&amp;) 
01086 { 
01087     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">type</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm15">appType</a> = dbField::tpBool; 
01088     <span class="keywordflow">return</span> fd;
01089 }
01090 <span class="keyword">inline</span> <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* dbDescribeField(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* fd, real4&amp;) 
01091 { 
01092     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">type</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm15">appType</a> = dbField::tpReal4; 
01093     <span class="keywordflow">return</span> fd;
01094 }
01095 <span class="keyword">inline</span> <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* dbDescribeField(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* fd, real8&amp;) 
01096 { 
01097     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">type</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm15">appType</a> = dbField::tpReal8; 
01098     <span class="keywordflow">return</span> fd;
01099 }
01100 <span class="keyword">inline</span> <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* dbDescribeField(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* fd, <a class="code" href="classrectangle.html">rectangle</a>&amp;)
01101 {
01102     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">type</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm15">appType</a> = dbField::tpRectangle;
01103     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm24">alignment</a> = <span class="keyword">sizeof</span>(coord_t);
01104     <span class="keywordflow">return</span> fd;
01105 }
01106 <span class="preprocessor">#ifdef USE_STD_STRING</span>
01107 <span class="preprocessor"></span><span class="keyword">inline</span> <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* dbDescribeField(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* fd, std::string&amp;)
01108 {
01109     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">type</a> = dbField::tpString;
01110     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm15">appType</a> = dbField::tpStdString;
01111     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm22">dbsSize</a> = <span class="keyword">sizeof</span>(dbVarying);
01112     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm24">alignment</a> = 4;
01113     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm19">components</a> = <span class="keyword">new</span> <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>(<span class="stringliteral">"[]"</span>);
01114     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm19">components</a>-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">type</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm19">components</a>-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm15">appType</a> = dbField::tpInt1;
01115     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm19">components</a>-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm22">dbsSize</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm19">components</a>-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm23">appSize</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm19">components</a>-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm24">alignment</a> = 1; 
01116     <span class="keywordflow">return</span> fd;
01117 }
01118 <span class="preprocessor">#endif</span>
01119 <span class="preprocessor"></span><span class="keyword">inline</span> <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* dbDescribeField(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* fd, <span class="keywordtype">char</span> <span class="keyword">const</span>*&amp;) 
01120 { 
01121     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">type</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm15">appType</a> = dbField::tpString; 
01122     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm22">dbsSize</a> = <span class="keyword">sizeof</span>(dbVarying); 
01123     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm24">alignment</a> = 4;
01124     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm19">components</a> = <span class="keyword">new</span> <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>(<span class="stringliteral">"[]"</span>);
01125     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm19">components</a>-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">type</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm19">components</a>-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm15">appType</a> = dbField::tpInt1;
01126     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm19">components</a>-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm22">dbsSize</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm19">components</a>-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm23">appSize</a> = 1;
01127     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm19">components</a>-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm24">alignment</a> = 1; 
01128     <span class="keywordflow">return</span> fd;
01129 }
01130 <span class="keyword">inline</span> <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* dbDescribeField(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* fd, <span class="keywordtype">char</span>*&amp;) 
01131 { 
01132     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">type</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm15">appType</a> = dbField::tpString; 
01133     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm22">dbsSize</a> = <span class="keyword">sizeof</span>(dbVarying); 
01134     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm24">alignment</a> = 4;
01135     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm19">components</a> = <span class="keyword">new</span> <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>(<span class="stringliteral">"[]"</span>);
01136     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm19">components</a>-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">type</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm19">components</a>-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm15">appType</a> = dbField::tpInt1;
01137     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm19">components</a>-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm22">dbsSize</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm19">components</a>-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm23">appSize</a> = 1;
01138     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm19">components</a>-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm24">alignment</a> = 1; 
01139     <span class="keywordflow">return</span> fd;
01140 }
01141 
01142 
<a name="l01146"></a><a class="code" href="classdbAnyMethodTrampoline.html">01146</a> <span class="keyword">class </span>FASTDB_DLL_ENTRY dbAnyMethodTrampoline { 
01147   <span class="keyword">public</span>:
01148     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* cls;
01149 
01155     <span class="keyword">virtual</span> <span class="keywordtype">void</span> invoke(byte* data, <span class="keywordtype">void</span>* result) = 0;
01156 
01163     <span class="keyword">virtual</span> dbAnyMethodTrampoline* optimize() = 0;
01164 
<a name="l01169"></a><a class="code" href="classdbAnyMethodTrampoline.html#dbAnyMethodTrampolinea2">01169</a>     dbAnyMethodTrampoline(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* fd) { cls = fd; }
01170     
01171     <span class="keywordtype">void</span>* operator new(size_t size EXTRA_DEBUG_NEW_PARAMS);
01172     <span class="keywordtype">void</span>  operator delete(<span class="keywordtype">void</span>* p EXTRA_DEBUG_NEW_PARAMS);
01173 
01177     <span class="keyword">virtual</span>~dbAnyMethodTrampoline();
01178 };
01179     
01180 
01181 <span class="preprocessor">#if defined(__APPLE__) || defined(__VACPP_MULTI__) || defined(__IBMCPP__) || defined(__HP_aCC) || (defined(__SUNPRO_CC) &amp;&amp; __SUNPRO_CC &gt;= 0x510 &amp;&amp; __SUNPRO_CC_COMPAT == 5)</span>
01182 <span class="preprocessor"></span>
01185 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T, <span class="keyword">class</span> R&gt;
01186 <span class="keyword">class </span><a class="code" href="classdbMethodTrampoline.html">dbMethodTrampoline</a> : <span class="keyword">public</span> dbAnyMethodTrampoline {
01187   <span class="keyword">public</span>:
01188     <span class="keyword">typedef</span> R (T::*mfunc)();
01189 
01190     mfunc              method;
01191     <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* cls;
01192     <span class="keywordtype">bool</span>               optimized;
01193 
01194     <span class="keywordtype">void</span> <a class="code" href="classdbMethodTrampoline.html#dbMethodTrampolinea0">invoke</a>(byte* data, <span class="keywordtype">void</span>* result) {
01195         <span class="keywordflow">if</span> (optimized) { 
01196             *(R*)result = (((T*)(data + this-&gt;cls-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm17">dbsOffs</a>))-&gt;*method)();
01197         } <span class="keywordflow">else</span> { 
01198             T rec;
01199             this-&gt;cls-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm19">components</a>-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptora7">fetchRecordFields</a>((byte*)&amp;rec, data);
01200             *(R*)result = (rec.*method)();
01201         }
01202     }
01203     dbAnyMethodTrampoline* <a class="code" href="classdbMethodTrampoline.html#dbMethodTrampolinea1">optimize</a>() { 
01204         optimized = <span class="keyword">true</span>;
01205         <span class="keywordflow">return</span> <span class="keyword">this</span>;
01206     }
01207 
01208     <a class="code" href="classdbMethodTrampoline.html">dbMethodTrampoline</a>(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* fd, mfunc f)
01209     : dbAnyMethodTrampoline(fd)
01210     {
01211         this-&gt;method = f;
01212         this-&gt;cls = fd;
01213         this-&gt;optimized = <span class="keyword">false</span>;
01214     }
01215 };
01216 
01217 <span class="preprocessor">#else</span>
01218 <span class="preprocessor"></span>
01222 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T, <span class="keyword">class</span> R&gt;
<a name="l01223"></a><a class="code" href="classdbMethodTrampoline.html">01223</a> <span class="keyword">class </span><a class="code" href="classdbMethodTrampoline.html">dbMethodTrampoline</a> : <span class="keyword">public</span> dbAnyMethodTrampoline { 
01224   <span class="keyword">public</span>:
01225     <span class="keyword">typedef</span> R (T::*mfunc)();
01226     mfunc method;
<a name="l01227"></a><a class="code" href="classdbMethodTrampoline.html#dbMethodTrampolinea0">01227</a>     <span class="keywordtype">void</span> <a class="code" href="classdbMethodTrampoline.html#dbMethodTrampolinea0">invoke</a>(byte* data, <span class="keywordtype">void</span>* result) {
01228         T rec;
01229         this-&gt;cls-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm19">components</a>-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptora7">fetchRecordFields</a>((byte*)&amp;rec, data);
01230         *(R*)result = (rec.*method)();
01231     }
01232     dbAnyMethodTrampoline* <a class="code" href="classdbMethodTrampoline.html#dbMethodTrampolinea1">optimize</a>();
01233  
01234     <a class="code" href="classdbMethodTrampoline.html">dbMethodTrampoline</a>(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* fd, mfunc f) 
01235     : dbAnyMethodTrampoline(fd), method(f) {} 
01236 };
01237 
01238 
01243 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T, <span class="keyword">class</span> R&gt;
<a name="l01244"></a><a class="code" href="classdbMethodFastTrampoline.html">01244</a> <span class="keyword">class </span><a class="code" href="classdbMethodFastTrampoline.html">dbMethodFastTrampoline</a> : <span class="keyword">public</span> dbAnyMethodTrampoline { 
01245     <span class="keyword">typedef</span> R (T::*mfunc)();
01246     mfunc method;
01247   <span class="keyword">public</span>:
<a name="l01248"></a><a class="code" href="classdbMethodFastTrampoline.html#dbMethodFastTrampolinea0">01248</a>     dbAnyMethodTrampoline* <a class="code" href="classdbMethodFastTrampoline.html#dbMethodFastTrampolinea0">optimize</a>() { 
01249         <span class="keywordflow">return</span> <span class="keyword">this</span>;
01250     }
<a name="l01251"></a><a class="code" href="classdbMethodFastTrampoline.html#dbMethodFastTrampolinea1">01251</a>     <span class="keywordtype">void</span> <a class="code" href="classdbMethodFastTrampoline.html#dbMethodFastTrampolinea1">invoke</a>(byte* data, <span class="keywordtype">void</span>* result) {
01252         *(R*)result = (((T*)(data + this-&gt;cls-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm17">dbsOffs</a>))-&gt;*method)();
01253     }
01254     <a class="code" href="classdbMethodFastTrampoline.html">dbMethodFastTrampoline</a>(<a class="code" href="classdbMethodTrampoline.html">dbMethodTrampoline&lt;T,R&gt;</a>* mt) 
01255     : dbAnyMethodTrampoline(mt-&gt;cls), method(mt-&gt;method) {
01256         <span class="keyword">delete</span> mt;
01257     }
01258 };
01259 
01260 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T, <span class="keyword">class</span> R&gt;
<a name="l01261"></a><a class="code" href="classdbMethodTrampoline.html#dbMethodTrampolinea1">01261</a> <span class="keyword">inline</span> dbAnyMethodTrampoline* <a class="code" href="classdbMethodTrampoline.html#dbMethodTrampolinea1">dbMethodTrampoline&lt;T,R&gt;::optimize</a>() { 
01262     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classdbMethodFastTrampoline.html">dbMethodFastTrampoline&lt;T,R&gt;</a>(this);
01263 }
01264     
01265 <span class="preprocessor">#endif</span>
01266 <span class="preprocessor"></span>
01267 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T, <span class="keyword">class</span> R&gt;
01268 <span class="keyword">inline</span> <a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* dbDescribeMethod(<a class="code" href="classdbFieldDescriptor.html">dbFieldDescriptor</a>* fd, R (T::*p)()) 
01269 { 
01270     R ret;
01271     dbDescribeField(fd, ret);
01272     assert(fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">type</a> &lt;= dbField::tpReference);
01273     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm15">appType</a> = fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm14">type</a> += dbField::tpMethodBool;
01274     fd-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptorm30">method</a> = <span class="keyword">new</span> <a class="code" href="classdbMethodTrampoline.html">dbMethodTrampoline&lt;T,R&gt;</a>(fd, p);
01275     <span class="keywordflow">return</span> fd;
01276 }
01277 
01278 END_FASTDB_NAMESPACE
01279 
01280 <span class="preprocessor">#endif</span>
01281 <span class="preprocessor"></span>
01282 
</pre></div><hr><address style="align: right;"><small>Generated on Thu Feb 14 12:42:30 2008 for FastDB by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.18 </small></address>
</body>
</html>
