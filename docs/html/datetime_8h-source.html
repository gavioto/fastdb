<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>datetime.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>datetime.h</h1><div class="fragment"><pre>00001 <span class="comment">//-&lt; DATEIME.H &gt;-----------------------------------------------------*--------*</span>
00002 <span class="comment">// FastDB                    Version 1.0         (c) 1999  GARRET    *     ?  *</span>
00003 <span class="comment">// (Main Memory Database Management System)                          *   /\|  *</span>
00004 <span class="comment">//                                                                   *  /  \  *</span>
00005 <span class="comment">//                          Created:     20-Nov-98    K.A. Knizhnik  * / [] \ *</span>
00006 <span class="comment">//                          Last update: 10-Dec-98    K.A. Knizhnik  * GARRET *</span>
00007 <span class="comment">//-------------------------------------------------------------------*--------*</span>
00008 <span class="comment">// Date-time field type</span>
00009 <span class="comment">//-------------------------------------------------------------------*--------*</span>
00010 
00011 <span class="preprocessor">#ifndef __DATETIME_H__</span>
00012 <span class="preprocessor"></span><span class="preprocessor">#define __DATETIME_H__</span>
00013 <span class="preprocessor"></span>
00014 <span class="preprocessor">#include "stdtp.h"</span>
00015 <span class="preprocessor">#include "class.h"</span>
00016 
00017 BEGIN_FASTDB_NAMESPACE
00018 
00019 <span class="keyword">class </span>FASTDB_DLL_ENTRY dbDateTime { 
00020     int4 stamp;
00021   <span class="keyword">public</span>:
00022     <span class="keywordtype">bool</span> operator == (dbDateTime <span class="keyword">const</span>&amp; dt)<span class="keyword"> const </span>{ 
00023         <span class="keywordflow">return</span> stamp == dt.stamp;
00024     }
00025     <span class="keywordtype">bool</span> operator != (dbDateTime <span class="keyword">const</span>&amp; dt)<span class="keyword"> const </span>{ 
00026         <span class="keywordflow">return</span> stamp != dt.stamp;
00027     }
00028     <span class="keywordtype">bool</span> operator &gt; (dbDateTime <span class="keyword">const</span>&amp; dt)<span class="keyword"> const </span>{ 
00029         <span class="keywordflow">return</span> stamp &gt; dt.stamp;
00030     }
00031     <span class="keywordtype">bool</span> operator &gt;= (dbDateTime <span class="keyword">const</span>&amp; dt)<span class="keyword"> const </span>{ 
00032         <span class="keywordflow">return</span> stamp &gt;= dt.stamp;
00033     }
00034     <span class="keywordtype">bool</span> operator &lt; (dbDateTime <span class="keyword">const</span>&amp; dt)<span class="keyword"> const </span>{ 
00035         <span class="keywordflow">return</span> stamp &lt; dt.stamp;
00036     }
00037     <span class="keywordtype">bool</span> operator &lt;= (dbDateTime <span class="keyword">const</span>&amp; dt)<span class="keyword"> const </span>{ 
00038         <span class="keywordflow">return</span> stamp &lt;= dt.stamp;
00039     }
00040     <span class="keywordtype">int</span> operator - (dbDateTime <span class="keyword">const</span>&amp; dt)<span class="keyword"> const </span>{ 
00041         <span class="keywordflow">return</span> stamp - dt.stamp;
00042     }
00043     <span class="keywordtype">int</span> operator + (dbDateTime <span class="keyword">const</span>&amp; dt)<span class="keyword"> const </span>{ 
00044         <span class="keywordflow">return</span> stamp + dt.stamp;
00045     }
00046     <span class="keyword">static</span> dbDateTime current() { 
00047         <span class="keywordflow">return</span> dbDateTime(time(NULL));
00048     }
00049     dbDateTime(time_t tm) {
00050         stamp = (int4)tm;
00051     }
00052     dbDateTime() { 
00053         stamp = -1;
00054     } 
00055     <span class="keywordtype">bool</span> isValid()<span class="keyword"> const </span>{ 
00056         <span class="keywordflow">return</span> stamp != -1;
00057     }
00058 
00059     time_t asTime_t()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> stamp; }
00060 
00061     <span class="keywordtype">void</span> clear() { stamp = -1; }
00062 
00063     dbDateTime(<span class="keywordtype">int</span> year, <span class="keywordtype">int</span> month, <span class="keywordtype">int</span> day, 
00064                <span class="keywordtype">int</span> hour=0, <span class="keywordtype">int</span> min=0, <span class="keywordtype">int</span> sec = 0) 
00065     { 
00066         <span class="keyword">struct </span>tm t;
00067         t.tm_year = year &gt; 1900 ? year - 1900 : year;
00068         t.tm_mon = month-1;
00069         t.tm_mday = day;
00070         t.tm_hour = hour;
00071         t.tm_min = min;
00072         t.tm_sec = sec;
00073         t.tm_isdst = -1;
00074         stamp = (int4)mktime(&amp;t);
00075     }
00076     dbDateTime(<span class="keywordtype">int</span> hour, <span class="keywordtype">int</span> min) { 
00077         stamp = (hour*60+min)*60;
00078     }
00079 
00080 <span class="preprocessor">#if defined(HAVE_LOCALTIME_R) &amp;&amp; !defined(NO_PTHREADS)</span>
00081 <span class="preprocessor"></span>    <span class="keywordtype">int</span> year() { 
00082         <span class="keyword">struct </span>tm t;
00083         time_t tt = (nat4)stamp;
00084         <span class="keywordflow">return</span> localtime_r(&amp;tt, &amp;t)-&gt;tm_year + 1900;
00085     }
00086     <span class="keywordtype">int</span> month() { <span class="comment">// 1..12</span>
00087         <span class="keyword">struct </span>tm t;
00088         time_t tt = (nat4)stamp;
00089         <span class="keywordflow">return</span> localtime_r(&amp;tt, &amp;t)-&gt;tm_mon + 1;
00090     }
00091     <span class="keywordtype">int</span> day() { <span class="comment">// 1..31</span>
00092         <span class="keyword">struct </span>tm t;
00093         time_t tt = (nat4)stamp;
00094         <span class="keywordflow">return</span> localtime_r(&amp;tt, &amp;t)-&gt;tm_mday;
00095     }
00096     <span class="keywordtype">int</span> dayOfYear() { <span class="comment">// 1..366</span>
00097         <span class="keyword">struct </span>tm t;
00098         time_t tt = (nat4)stamp;
00099         <span class="keywordflow">return</span> localtime_r(&amp;tt, &amp;t)-&gt;tm_yday+1;
00100     }
00101     <span class="keywordtype">int</span> dayOfWeek() { <span class="comment">// 1..7</span>
00102         <span class="keyword">struct </span>tm t;
00103         time_t tt = (nat4)stamp;
00104         <span class="keywordflow">return</span> localtime_r(&amp;tt, &amp;t)-&gt;tm_wday+1;
00105     }
00106     <span class="keywordtype">int</span> hour() { <span class="comment">// 0..24</span>
00107         <span class="keyword">struct </span>tm t;
00108         time_t tt = (nat4)stamp;
00109         <span class="keywordflow">return</span> localtime_r(&amp;tt, &amp;t)-&gt;tm_hour;
00110     }
00111     <span class="keywordtype">int</span> minute() { <span class="comment">// 0..59</span>
00112         <span class="keyword">struct </span>tm t;
00113         time_t tt = (nat4)stamp;
00114         <span class="keywordflow">return</span> localtime_r(&amp;tt, &amp;t)-&gt;tm_min;
00115     }
00116     <span class="keywordtype">int</span> second() { <span class="comment">// 0..59</span>
00117         <span class="keyword">struct </span>tm t;
00118         time_t tt = (nat4)stamp;
00119         <span class="keywordflow">return</span> localtime_r(&amp;tt, &amp;t)-&gt;tm_sec;
00120     }
00121     <span class="keywordtype">char</span>* asString(<span class="keywordtype">char</span>* buf, <span class="keywordtype">int</span> buf_size, <span class="keywordtype">char</span> <span class="keyword">const</span>* format = <span class="stringliteral">"%c"</span>)<span class="keyword"> const </span>{ 
00122         <span class="keyword">struct </span>tm t;
00123         time_t tt = (nat4)stamp;
00124         strftime(buf, buf_size, format, localtime_r(&amp;tt, &amp;t));
00125         <span class="keywordflow">return</span> buf;
00126     }
00127     <span class="keyword">static</span> dbDateTime currentDate() { 
00128         <span class="keyword">struct </span>tm t;
00129         time_t curr = time(NULL);
00130         localtime_r(&amp;curr, &amp;t);
00131         t.tm_hour = 0;
00132         t.tm_min = 0;
00133         t.tm_sec = 0;
00134         <span class="keywordflow">return</span> dbDateTime(mktime(&amp;t));
00135     }
00136 <span class="preprocessor">#else</span>
00137 <span class="preprocessor"></span>    <span class="keywordtype">int</span> year() { 
00138         time_t tt = (nat4)stamp;
00139         <span class="keywordflow">return</span> localtime(&amp;tt)-&gt;tm_year + 1900;
00140     }
00141     <span class="keywordtype">int</span> month() { <span class="comment">// 1..12</span>
00142         time_t tt = (nat4)stamp;
00143         <span class="keywordflow">return</span> localtime(&amp;tt)-&gt;tm_mon + 1;
00144     }
00145     <span class="keywordtype">int</span> day() { <span class="comment">// 1..31</span>
00146         time_t tt = (nat4)stamp;
00147         <span class="keywordflow">return</span> localtime(&amp;tt)-&gt;tm_mday;
00148     }
00149     <span class="keywordtype">int</span> dayOfYear() { <span class="comment">// 1..366</span>
00150         time_t tt = (nat4)stamp;
00151         <span class="keywordflow">return</span> localtime(&amp;tt)-&gt;tm_yday+1;
00152     }
00153     <span class="keywordtype">int</span> dayOfWeek() { <span class="comment">// 1..7</span>
00154         time_t tt = (nat4)stamp;
00155         <span class="keywordflow">return</span> localtime(&amp;tt)-&gt;tm_wday+1;
00156     }
00157     <span class="keywordtype">int</span> hour() { <span class="comment">// 0..24</span>
00158         time_t tt = (nat4)stamp;
00159         <span class="keywordflow">return</span> localtime(&amp;tt)-&gt;tm_hour;
00160     }
00161     <span class="keywordtype">int</span> minute() { <span class="comment">// 0..59</span>
00162         time_t tt = (nat4)stamp;
00163         <span class="keywordflow">return</span> localtime(&amp;tt)-&gt;tm_min;
00164     }
00165     <span class="keywordtype">int</span> second() { <span class="comment">// 0..59</span>
00166         time_t tt = (nat4)stamp;
00167         <span class="keywordflow">return</span> localtime(&amp;tt)-&gt;tm_sec;
00168     }
00169     <span class="keywordtype">char</span>* asString(<span class="keywordtype">char</span>* buf, <span class="keywordtype">int</span> buf_size, <span class="keywordtype">char</span> <span class="keyword">const</span>* format = <span class="stringliteral">"%c"</span>)<span class="keyword"> const </span>{ 
00170         time_t tt = (nat4)stamp;
00171 <span class="preprocessor">#ifdef _WINCE</span>
00172 <span class="preprocessor"></span>        <span class="keyword">struct </span>tm* t = localtime(&amp;tt);
00173         <span class="keywordtype">char</span> cnvBuf[CNV_BUF_SIZE];
00174         sprintf(cnvBuf, <span class="stringliteral">"%02d/02d/%40d %02d:%02d:%02d"</span>, t-&gt;tm_mon, t-&gt;tm_yday+1, t-&gt;tm_year + 1900,
00175                 t-&gt;tm_hour, t-&gt;tm_min, t-&gt;tm_sec);
00176         strncpy(buf, cnvBuf, buf_size);
00177 <span class="preprocessor">#else</span>
00178 <span class="preprocessor"></span>        strftime(buf, buf_size, format, localtime(&amp;tt));
00179 <span class="preprocessor">#endif</span>
00180 <span class="preprocessor"></span>        <span class="keywordflow">return</span> buf;
00181     }
00182     <span class="keyword">static</span> dbDateTime currentDate() { 
00183         time_t curr = time(NULL);
00184         <span class="keyword">struct </span>tm* tp = localtime(&amp;curr);;
00185         tp-&gt;tm_hour = 0;
00186         tp-&gt;tm_min = 0;
00187         tp-&gt;tm_sec = 0;
00188         <span class="keywordflow">return</span> dbDateTime(mktime(tp));
00189     }
00190 <span class="preprocessor">#endif    </span>
00191 <span class="preprocessor"></span>
00192     CLASS_DESCRIPTOR(dbDateTime, 
00193                      (KEY(stamp,INDEXED|HASHED), 
00194                       METHOD(year), METHOD(month), METHOD(day),
00195                       METHOD(dayOfYear), METHOD(dayOfWeek),
00196                       METHOD(hour), METHOD(minute), METHOD(second)));
00197 
00198     <a class="code" href="classdbQueryExpression.html">dbQueryExpression</a> operator == (<span class="keywordtype">char</span> <span class="keyword">const</span>* field) { 
00199         <a class="code" href="classdbQueryExpression.html">dbQueryExpression</a> expr;
00200         expr = <a class="code" href="classdbComponent.html">dbComponent</a>(field,<span class="stringliteral">"stamp"</span>),<span class="stringliteral">"="</span>,stamp;
00201         <span class="keywordflow">return</span> expr;
00202     }
00203     <a class="code" href="classdbQueryExpression.html">dbQueryExpression</a> operator != (<span class="keywordtype">char</span> <span class="keyword">const</span>* field) { 
00204         <a class="code" href="classdbQueryExpression.html">dbQueryExpression</a> expr;
00205         expr = <a class="code" href="classdbComponent.html">dbComponent</a>(field,<span class="stringliteral">"stamp"</span>),<span class="stringliteral">"&lt;&gt;"</span>,stamp;
00206         <span class="keywordflow">return</span> expr;
00207     }
00208     <a class="code" href="classdbQueryExpression.html">dbQueryExpression</a> operator &lt; (<span class="keywordtype">char</span> <span class="keyword">const</span>* field) { 
00209         <a class="code" href="classdbQueryExpression.html">dbQueryExpression</a> expr;
00210         expr = <a class="code" href="classdbComponent.html">dbComponent</a>(field,<span class="stringliteral">"stamp"</span>),<span class="stringliteral">"&gt;"</span>,stamp;
00211         <span class="keywordflow">return</span> expr;
00212     }
00213     <a class="code" href="classdbQueryExpression.html">dbQueryExpression</a> operator &lt;= (<span class="keywordtype">char</span> <span class="keyword">const</span>* field) { 
00214         <a class="code" href="classdbQueryExpression.html">dbQueryExpression</a> expr;
00215         expr = <a class="code" href="classdbComponent.html">dbComponent</a>(field,<span class="stringliteral">"stamp"</span>),<span class="stringliteral">"&gt;="</span>,stamp;
00216         <span class="keywordflow">return</span> expr;
00217     }
00218     <a class="code" href="classdbQueryExpression.html">dbQueryExpression</a> operator &gt; (<span class="keywordtype">char</span> <span class="keyword">const</span>* field) { 
00219         <a class="code" href="classdbQueryExpression.html">dbQueryExpression</a> expr;
00220         expr = <a class="code" href="classdbComponent.html">dbComponent</a>(field,<span class="stringliteral">"stamp"</span>),<span class="stringliteral">"&lt;"</span>,stamp;
00221         <span class="keywordflow">return</span> expr;
00222     }
00223     <a class="code" href="classdbQueryExpression.html">dbQueryExpression</a> operator &gt;= (<span class="keywordtype">char</span> <span class="keyword">const</span>* field) { 
00224         <a class="code" href="classdbQueryExpression.html">dbQueryExpression</a> expr;
00225         expr = <a class="code" href="classdbComponent.html">dbComponent</a>(field,<span class="stringliteral">"stamp"</span>),<span class="stringliteral">"&lt;="</span>,stamp;
00226         <span class="keywordflow">return</span> expr;
00227     }
00228     <span class="keyword">friend</span> <a class="code" href="classdbQueryExpression.html">dbQueryExpression</a> between(<span class="keywordtype">char</span> <span class="keyword">const</span>* field, dbDateTime&amp; from,
00229                                      dbDateTime&amp; till)
00230     { 
00231         <a class="code" href="classdbQueryExpression.html">dbQueryExpression</a> expr;
00232         expr=<a class="code" href="classdbComponent.html">dbComponent</a>(field,<span class="stringliteral">"stamp"</span>),<span class="stringliteral">"between"</span>,from.stamp,<span class="stringliteral">"and"</span>,till.stamp;
00233         <span class="keywordflow">return</span> expr;
00234     }
00235 
00236     <span class="keyword">static</span> <a class="code" href="classdbQueryExpression.html">dbQueryExpression</a> ascent(<span class="keywordtype">char</span> <span class="keyword">const</span>* field) { 
00237         <a class="code" href="classdbQueryExpression.html">dbQueryExpression</a> expr;
00238         expr=<a class="code" href="classdbComponent.html">dbComponent</a>(field,<span class="stringliteral">"stamp"</span>);
00239         <span class="keywordflow">return</span> expr;
00240     }   
00241     <span class="keyword">static</span> <a class="code" href="classdbQueryExpression.html">dbQueryExpression</a> descent(<span class="keywordtype">char</span> <span class="keyword">const</span>* field) { 
00242         <a class="code" href="classdbQueryExpression.html">dbQueryExpression</a> expr;
00243         expr=<a class="code" href="classdbComponent.html">dbComponent</a>(field,<span class="stringliteral">"stamp"</span>),<span class="stringliteral">"desc"</span>;
00244         <span class="keywordflow">return</span> expr;
00245     }   
00246 };
00247 
00248 END_FASTDB_NAMESPACE
00249 
00250 <span class="preprocessor">#endif</span>
</pre></div><hr><address style="align: right;"><small>Generated on Thu Feb 14 12:42:30 2008 for FastDB by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.18 </small></address>
</body>
</html>
