<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>cursor.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>cursor.h</h1><div class="fragment"><pre>00001 <span class="comment">//-&lt; CURSOR.H &gt;------------------------------------------------------*--------*</span>
00002 <span class="comment">// FastDB                    Version 1.0         (c) 1999  GARRET    *     ?  *</span>
00003 <span class="comment">// (Main Memory Database Management System)                          *   /\|  *</span>
00004 <span class="comment">//                                                                   *  /  \  *</span>
00005 <span class="comment">//                          Created:     20-Nov-98    K.A. Knizhnik  * / [] \ *</span>
00006 <span class="comment">//                          Last update: 10-Dec-98    K.A. Knizhnik  * GARRET *</span>
00007 <span class="comment">//-------------------------------------------------------------------*--------*</span>
00008 <span class="comment">// Table cursor</span>
00009 <span class="comment">//-------------------------------------------------------------------*--------*</span>
00010 
00011 <span class="preprocessor">#ifndef __CURSOR_H__</span>
00012 <span class="preprocessor"></span><span class="preprocessor">#define __CURSOR_H__</span>
00013 <span class="preprocessor"></span>
00014 BEGIN_FASTDB_NAMESPACE
00015 
00016 <span class="keyword">class </span>dbOrderByNode;
00017 
00018 <span class="keyword">class </span>FASTDB_DLL_ENTRY dbSelection { 
00019   <span class="keyword">public</span>:
00020     <span class="keyword">enum</span> { quantum = 1024 };
00021     <span class="keyword">class </span>segment { 
00022       <span class="keyword">public</span>:
00023         segment* prev;
00024         segment* next;
00025         size_t   nRows;
00026         oid_t    rows[quantum];
00027 
00028         segment(segment* after) { 
00029             prev = after;
00030             next = NULL;
00031             nRows = 0;
00032         }       
00033     };
00034     segment*  first;
00035     segment*  last;
00036     segment*  curr;
00037     size_t    nRows;
00038     size_t    pos;
00039 
00040     segment*  createNewSegment(segment* after);
00041 
00042     <span class="keywordtype">void</span> add(oid_t oid) {
00043         <span class="keywordflow">if</span> (last == NULL) { 
00044             first = last = createNewSegment(NULL);
00045         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (last-&gt;nRows == quantum) { 
00046             last = last-&gt;next = createNewSegment(last);
00047         }
00048         last-&gt;rows[last-&gt;nRows++] = oid;
00049         nRows += 1;
00050     }
00051    
00052     <span class="keywordtype">void</span> sort(<a class="code" href="classdbDatabase.html">dbDatabase</a>* db, dbOrderByNode* order);
00053     <span class="keyword">static</span> <span class="keywordtype">int</span> compare(oid_t a, oid_t b, dbOrderByNode* order);
00054 
00055     <span class="keywordtype">void</span> toArray(oid_t* oids) <span class="keyword">const</span>;
00056     <span class="keywordtype">void</span> truncate(size_t from, size_t length);
00057 
00058     dbSelection() { 
00059         nRows = 0;
00060         pos = 0;
00061         first = curr = last = NULL;
00062     }
00063     <span class="keywordtype">void</span> reverse();
00064     <span class="keywordtype">void</span> reset();
00065 };
00066 
00067 <span class="keyword">enum</span> dbCursorType { 
00068     dbCursorViewOnly,
00069     dbCursorForUpdate
00070 };
00071 
<a name="l00075"></a><a class="code" href="classdbAnyCursor.html">00075</a> <span class="keyword">class </span>FASTDB_DLL_ENTRY dbAnyCursor : <span class="keyword">public</span> <a class="code" href="classdbL2List.html">dbL2List</a> { 
00076     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classdbAnyContainer.html">dbAnyContainer</a>;
00077     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classdbDatabase.html">dbDatabase</a>;
00078     <span class="keyword">friend</span> <span class="keyword">class </span>dbHashTable;
00079     <span class="keyword">friend</span> <span class="keyword">class </span>dbTtreeNode;
00080     <span class="keyword">friend</span> <span class="keyword">class </span>dbRtreePage;
00081     <span class="keyword">friend</span> <span class="keyword">class </span>dbSubSql;
00082     <span class="keyword">friend</span> <span class="keyword">class </span>dbStatement;
00083     <span class="keyword">friend</span> <span class="keyword">class </span>dbServer;
00084     <span class="keyword">friend</span> <span class="keyword">class </span>dbCLI;
00085     <span class="keyword">friend</span> <span class="keyword">class </span>JniResultSet;
00086   <span class="keyword">public</span>:
<a name="l00091"></a><a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a13">00091</a>     <span class="keywordtype">int</span> getNumberOfRecords()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (int)selection.nRows; }
00092 
00096     <span class="keywordtype">void</span> remove();
00097     
<a name="l00102"></a><a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a15">00102</a>     <span class="keywordtype">bool</span> isEmpty()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> currId == 0; }
00103 
<a name="l00108"></a><a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a17">00108</a>     <span class="keywordtype">bool</span> isUpdateCursor()<span class="keyword"> const </span>{ 
00109         <span class="keywordflow">return</span> type == dbCursorForUpdate;
00110     }
00111 
<a name="l00116"></a><a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a18">00116</a>     <span class="keywordtype">bool</span> isLimitReached()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> selection.nRows &gt;= limit || selection.nRows &gt;= stmtLimitLen; }
00117 
00125     oid_t* toArrayOfOid(oid_t* arr) <span class="keyword">const</span>; 
00126 
<a name="l00137"></a><a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a20">00137</a>     <span class="keywordtype">int</span> select(<a class="code" href="classdbQuery.html">dbQuery</a>&amp; query, dbCursorType aType, <span class="keywordtype">void</span>* paramStruct = NULL) {
00138         type = aType;
00139         reset();
00140         paramBase = paramStruct;
00141         db-&gt;select(<span class="keyword">this</span>, query);
00142         paramBase = NULL;
00143         <span class="keywordflow">if</span> (gotoFirst() &amp;&amp; prefetch) { 
00144             fetch();
00145         }
00146         <span class="keywordflow">return</span> (int)selection.nRows;
00147     } 
00148     
<a name="l00155"></a><a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a21">00155</a>     <span class="keywordtype">int</span> select(<a class="code" href="classdbQuery.html">dbQuery</a>&amp; query, <span class="keywordtype">void</span>* paramStruct = NULL) { 
00156         <span class="keywordflow">return</span> select(query, defaultType, paramStruct);
00157     }
00158      
<a name="l00166"></a><a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a22">00166</a>     <span class="keywordtype">int</span> select(<span class="keywordtype">char</span> <span class="keyword">const</span>* condition, dbCursorType aType, <span class="keywordtype">void</span>* paramStruct = NULL) { 
00167         <a class="code" href="classdbQuery.html">dbQuery</a> query(condition);
00168         <span class="keywordflow">return</span> select(query, aType, paramStruct);
00169     } 
00170 
<a name="l00177"></a><a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a23">00177</a>     <span class="keywordtype">int</span> select(<span class="keywordtype">char</span> <span class="keyword">const</span>* condition, <span class="keywordtype">void</span>* paramStruct = NULL) { 
00178         <span class="keywordflow">return</span> select(condition, defaultType, paramStruct);
00179     }
00180 
<a name="l00186"></a><a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a24">00186</a>     <span class="keywordtype">int</span> select(dbCursorType aType) { 
00187         type = aType;
00188         reset();
00189         db-&gt;select(<span class="keyword">this</span>); 
00190         <span class="keywordflow">if</span> (gotoFirst() &amp;&amp; prefetch) { 
00191             fetch();
00192         }
00193         <span class="keywordflow">return</span> (int)selection.nRows;
00194     } 
00195 
<a name="l00200"></a><a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a25">00200</a>     <span class="keywordtype">int</span> select() {
00201         <span class="keywordflow">return</span> select(defaultType);
00202     }
00203 
00210     <span class="keywordtype">int</span> selectByKey(<span class="keywordtype">char</span> <span class="keyword">const</span>* key, <span class="keywordtype">void</span> <span class="keyword">const</span>* value);
00211 
00219     <span class="keywordtype">int</span> selectByKeyRange(<span class="keywordtype">char</span> <span class="keyword">const</span>* key, <span class="keywordtype">void</span> <span class="keyword">const</span>* minValue, <span class="keywordtype">void</span> <span class="keyword">const</span>* maxValue);
00220 
<a name="l00225"></a><a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a28">00225</a>     <span class="keywordtype">void</span> update() { 
00226         assert(type == dbCursorForUpdate &amp;&amp; currId != 0);
00227         db-&gt;update(currId, table, record);
00228     }
00229 
<a name="l00233"></a><a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a29">00233</a>     <span class="keywordtype">void</span> removeAll() {
00234         assert(db != NULL);
00235         db-&gt;deleteTable(table);
00236         reset();
00237     }
00238 
00242     <span class="keywordtype">void</span> removeAllSelected();
00243 
<a name="l00247"></a><a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a31">00247</a>     <span class="keywordtype">void</span> setSelectionLimit(size_t lim) { limit = lim; }
00248     
<a name="l00252"></a><a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a32">00252</a>     <span class="keywordtype">void</span> unsetSelectionLimit() { limit = dbDefaultSelectionLimit; }
00253 
<a name="l00260"></a><a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a33">00260</a>     <span class="keywordtype">void</span> setPrefetchMode(<span class="keywordtype">bool</span> mode) { prefetch = mode; }
00261 
00262 
<a name="l00267"></a><a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a34">00267</a>     <span class="keywordtype">void</span> enableCheckForDuplicates(<span class="keywordtype">bool</span> enabled) {
00268         checkForDuplicatedIsEnabled = enabled;
00269     }
00270         
00271 
00275     <span class="keywordtype">void</span> reset();
00276 
00281     <span class="keywordtype">bool</span> isLast() <span class="keyword">const</span>; 
00282 
00287     <span class="keywordtype">bool</span> isFirst() <span class="keyword">const</span>; 
00288 
00294     <span class="keywordtype">void</span> freeze();
00295 
00299     <span class="keywordtype">void</span> unfreeze();
00300 
00308     <span class="keywordtype">bool</span> skip(<span class="keywordtype">int</span> n);
00309 
00310 
00316     <span class="keywordtype">int</span> seek(oid_t oid);
00317 
<a name="l00321"></a><a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a42">00321</a>     <a class="code" href="classdbTableDescriptor.html">dbTableDescriptor</a>* getTable() { <span class="keywordflow">return</span> table; }
00322 
00323 
<a name="l00328"></a><a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a43">00328</a>     <span class="keywordtype">void</span> setTable(<a class="code" href="classdbTableDescriptor.html">dbTableDescriptor</a>* aTable) { 
00329         table = aTable;
00330         db = aTable-&gt;<a class="code" href="classdbTableDescriptor.html#dbTableDescriptorn10">db</a>;
00331     }
00332 
<a name="l00337"></a><a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a44">00337</a>     <span class="keywordtype">void</span> setRecord(<span class="keywordtype">void</span>* rec) { 
00338         record = (byte*)rec;
00339     }
00340 
<a name="l00345"></a><a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a45">00345</a>     <span class="keywordtype">void</span>* getRecord() { 
00346         <span class="keywordflow">return</span> record;
00347     }
00348 
00353     <span class="keywordtype">bool</span> isInSelection(oid_t oid);
00354 
00355 
<a name="l00360"></a><a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a47">00360</a>     <span class="keywordtype">void</span> fetch() { 
00361         assert(!(db-&gt;currIndex[currId] 
00362                  &amp; (dbInternalObjectMarker|dbFreeHandleMarker)));
00363         table-&gt;columns-&gt;fetchRecordFields(record, 
00364                                           (byte*)db-&gt;getRow(currId));
00365     }
00366 
00370     <span class="keywordtype">bool</span> hasNext() <span class="keyword">const</span>;
00371     
00372   <span class="keyword">protected</span>: 
00373     <a class="code" href="classdbDatabase.html">dbDatabase</a>*        db;
00374     <a class="code" href="classdbTableDescriptor.html">dbTableDescriptor</a>* table;
00375     dbCursorType       type;
00376     dbCursorType       defaultType;
00377     dbSelection        selection;
00378     <span class="keywordtype">bool</span>               allRecords;
00379     oid_t              firstId;
00380     oid_t              lastId;
00381     oid_t              currId;
00382     byte*              record;
00383     size_t             limit;
00384 
00385     int4*              bitmap; <span class="comment">// bitmap to avoid duplicates</span>
00386     size_t             bitmapSize;
00387     <span class="keywordtype">bool</span>               eliminateDuplicates;
00388     <span class="keywordtype">bool</span>               checkForDuplicatedIsEnabled;
00389     <span class="keywordtype">bool</span>               prefetch;
00390     <span class="keywordtype">bool</span>               removed; <span class="comment">// current record was removed</span>
00391     <span class="keywordtype">bool</span>               lastRecordWasDeleted; <span class="comment">//last record was deleted</span>
00392 
00393     size_t             stmtLimitStart;
00394     size_t             stmtLimitLen;
00395     size_t             nSkipped;
00396 
00397     <span class="keywordtype">void</span>*              paramBase;
00398     
00399     <span class="keywordtype">void</span> checkForDuplicates();
00400     <span class="keywordtype">void</span> deallocateBitmap();
00401 
00402     <span class="keywordtype">bool</span> isMarked(oid_t oid) { 
00403         <span class="keywordflow">return</span> bitmap != NULL &amp;&amp; (bitmap[oid &gt;&gt; 5] &amp; (1 &lt;&lt; (oid &amp; 31))) != 0;
00404     }
00405 
00406     <span class="keywordtype">void</span> setStatementLimit(<a class="code" href="classdbQuery.html">dbQuery</a> <span class="keyword">const</span>&amp; q) { 
00407         stmtLimitStart = q.<a class="code" href="classdbCompiledQuery.html#dbQuerym8">stmtLimitStartPtr</a> != NULL ? (nat4)*q.<a class="code" href="classdbCompiledQuery.html#dbQuerym8">stmtLimitStartPtr</a> : q.<a class="code" href="classdbCompiledQuery.html#dbQuerym6">stmtLimitStart</a>;
00408         stmtLimitLen = q.<a class="code" href="classdbCompiledQuery.html#dbQuerym9">stmtLimitLenPtr</a> != NULL ? (nat4)*q.<a class="code" href="classdbCompiledQuery.html#dbQuerym9">stmtLimitLenPtr</a> : q.<a class="code" href="classdbCompiledQuery.html#dbQuerym7">stmtLimitLen</a>;
00409     }
00410 
00411     <span class="keywordtype">void</span> truncateSelection() { 
00412         selection.truncate(stmtLimitStart, stmtLimitLen);
00413     }
00414 
00415     <span class="keywordtype">void</span> mark(oid_t oid) { 
00416         <span class="keywordflow">if</span> (bitmap != NULL) { 
00417             bitmap[oid &gt;&gt; 5] |= 1 &lt;&lt; (oid &amp; 31);
00418         }
00419     }    
00420 
00421     <span class="keywordtype">bool</span> add(oid_t oid) { 
00422         <span class="keywordflow">if</span> (selection.nRows &lt; limit &amp;&amp; selection.nRows &lt; stmtLimitLen) { 
00423             <span class="keywordflow">if</span> (nSkipped &lt; stmtLimitStart) { 
00424                 nSkipped += 1;
00425                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00426             }
00427             <span class="keywordflow">if</span> (eliminateDuplicates) { 
00428                 <span class="keywordflow">if</span> (bitmap[oid &gt;&gt; 5] &amp; (1 &lt;&lt; (oid &amp; 31))) { 
00429                     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00430                 }
00431                 bitmap[oid &gt;&gt; 5] |= 1 &lt;&lt; (oid &amp; 31);
00432             } 
00433             selection.add(oid);
00434             <span class="keywordflow">return</span> selection.nRows &lt; limit;
00435         } 
00436         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00437     }
00438 
00439     byte* fetchNext();
00440     byte* fetchPrev();
00441 
00442     <span class="keywordtype">bool</span> gotoNext();
00443     <span class="keywordtype">bool</span> gotoPrev(); 
00444     <span class="keywordtype">bool</span> gotoFirst();
00445     <span class="keywordtype">bool</span> gotoLast();
00446     
00447     <span class="keywordtype">bool</span> moveNext();
00448     <span class="keywordtype">bool</span> movePrev();
00449 
00450     <span class="keywordtype">void</span> setCurrent(<a class="code" href="classdbAnyReference.html">dbAnyReference</a> <span class="keyword">const</span>&amp; ref);
00451 
00452     <span class="keywordtype">void</span> adjustReferences(size_t base, size_t size, <span class="keywordtype">long</span> shift) { 
00453         <span class="keywordflow">if</span> (currId != 0 &amp;&amp; record != NULL) { 
00454             table-&gt;<a class="code" href="classdbTableDescriptor.html#dbTableDescriptorn4">columns</a>-&gt;<a class="code" href="classdbFieldDescriptor.html#dbFieldDescriptora8">adjustReferences</a>(record, base, size, shift);
00455         }
00456     }
00457 
00458     dbAnyCursor(<a class="code" href="classdbTableDescriptor.html">dbTableDescriptor</a>&amp; aTable, dbCursorType aType, byte* rec)
00459     : table(&amp;aTable),type(aType),defaultType(aType),
00460       allRecords(false),currId(0),record(rec)
00461     {
00462         db = aTable.<a class="code" href="classdbTableDescriptor.html#dbTableDescriptorn10">db</a>;
00463         limit = dbDefaultSelectionLimit;
00464         prefetch = rec != NULL;
00465         removed = <span class="keyword">false</span>;
00466         bitmap = NULL; 
00467         bitmapSize = 0;
00468         eliminateDuplicates = <span class="keyword">false</span>;
00469         checkForDuplicatedIsEnabled = <span class="keyword">true</span>;
00470         paramBase = NULL;
00471         stmtLimitLen = dbDefaultSelectionLimit;
00472         stmtLimitStart = 0;
00473         nSkipped = 0;
00474     }
00475   <span class="keyword">public</span>:
00476     dbAnyCursor() 
00477     : table(NULL),type(dbCursorViewOnly),defaultType(dbCursorViewOnly),
00478           allRecords(false),currId(0),record(NULL)
00479     {
00480         limit = dbDefaultSelectionLimit;
00481         prefetch = <span class="keyword">false</span>;
00482         removed = <span class="keyword">false</span>;
00483         bitmap = NULL;
00484         bitmapSize = 0;
00485         eliminateDuplicates = <span class="keyword">false</span>;
00486         checkForDuplicatedIsEnabled = <span class="keyword">true</span>;
00487         db = NULL;
00488         paramBase = NULL;
00489         stmtLimitLen = dbDefaultSelectionLimit;
00490         stmtLimitStart = 0;
00491         nSkipped = 0;
00492     }
00493     ~dbAnyCursor();
00494 };
00495 
00496 
00500 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00501"></a><a class="code" href="classdbCursor.html">00501</a> <span class="keyword">class </span><a class="code" href="classdbCursor.html">dbCursor</a> : <span class="keyword">public</span> dbAnyCursor { 
00502   <span class="keyword">private</span>:
00503     <span class="comment">// Itis not possible to copy cursors</span>
00504     <a class="code" href="classdbCursor.html">dbCursor&lt;T&gt;</a> operator = (<a class="code" href="classdbCursor.html">dbCursor&lt;T&gt;</a> <span class="keyword">const</span>&amp; src) { 
00505         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00506     } 
00507 
00508   <span class="keyword">protected</span>:
00509     T record;
00510     
00511   <span class="keyword">public</span>:
<a name="l00516"></a><a class="code" href="classdbCursor.html#dbCursora0">00516</a>     <a class="code" href="classdbCursor.html#dbCursora0">dbCursor</a>(dbCursorType type = dbCursorViewOnly) 
00517         : dbAnyCursor(T::dbDescriptor, type, (byte*)&amp;record) {}
00518 
<a name="l00525"></a><a class="code" href="classdbCursor.html#dbCursora1">00525</a>     <a class="code" href="classdbCursor.html#dbCursora0">dbCursor</a>(<a class="code" href="classdbDatabase.html">dbDatabase</a>* aDb, dbCursorType type = dbCursorViewOnly)
00526         : dbAnyCursor(T::dbDescriptor, type, (byte*)&amp;record)
00527     {
00528         db = aDb;
00529         <a class="code" href="classdbTableDescriptor.html">dbTableDescriptor</a>* theTable = db-&gt;<a class="code" href="classdbDatabase.html#dbSubSqla41">lookupTable</a>(table);
00530         <span class="keywordflow">if</span> (theTable != NULL) { 
00531             table = theTable;
00532         }
00533     }
00534 
<a name="l00539"></a><a class="code" href="classdbCursor.html#dbCursora2">00539</a>     T* <a class="code" href="classdbCursor.html#dbCursora2">get</a>() { 
00540         <span class="keywordflow">return</span> currId == 0 ? (T*)NULL : &amp;record; 
00541     }
00542     
<a name="l00547"></a><a class="code" href="classdbCursor.html#dbCursora3">00547</a>     T* <a class="code" href="classdbCursor.html#dbCursora3">next</a>() {
00548         <span class="keywordflow">return</span> (T*)fetchNext();
00549     }
00550 
<a name="l00555"></a><a class="code" href="classdbCursor.html#dbCursora4">00555</a>     T* <a class="code" href="classdbCursor.html#dbCursora4">prev</a>() { 
00556         <span class="keywordflow">return</span> (T*)fetchPrev();
00557     }
00558 
<a name="l00563"></a><a class="code" href="classdbCursor.html#dbCursora5">00563</a>     T* <a class="code" href="classdbCursor.html#dbCursora5">first</a>() { 
00564         <span class="keywordflow">if</span> (gotoFirst()) {
00565             <a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a47">fetch</a>();
00566             <span class="keywordflow">return</span> &amp;record;
00567         }
00568         <span class="keywordflow">return</span> NULL;
00569     }
00570 
<a name="l00575"></a><a class="code" href="classdbCursor.html#dbCursora6">00575</a>     T* <a class="code" href="classdbCursor.html#dbCursora6">last</a>() { 
00576         <span class="keywordflow">if</span> (gotoLast()) {
00577             <a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a47">fetch</a>();
00578             <span class="keywordflow">return</span> &amp;record;
00579         }
00580         <span class="keywordflow">return</span> NULL;
00581     }    
00582     
<a name="l00588"></a><a class="code" href="classdbCursor.html#dbCursora7">00588</a>     <span class="keywordtype">int</span> <a class="code" href="classdbCursor.html#dbCursora7">seek</a>(<a class="code" href="classdbReference.html">dbReference&lt;T&gt;</a> <span class="keyword">const</span>&amp; ref) { 
00589         <span class="keywordflow">return</span> <a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a41">dbAnyCursor::seek</a>(ref.<a class="code" href="classdbAnyReference.html#dbReferencea13">getOid</a>());
00590     }
00591 
<a name="l00596"></a><a class="code" href="classdbCursor.html#dbCursora8">00596</a>     T* <a class="code" href="classdbCursor.html#dbCursora8">operator -&gt;</a>() { 
00597         assert(currId != 0);
00598         <span class="keywordflow">return</span> &amp;record;
00599     }
00600 
<a name="l00606"></a><a class="code" href="classdbCursor.html#dbCursora9">00606</a>     T* <a class="code" href="classdbCursor.html#dbCursora9">at</a>(<a class="code" href="classdbReference.html">dbReference&lt;T&gt;</a> <span class="keyword">const</span>&amp; ref) { 
00607         setCurrent(ref);
00608         <span class="keywordflow">return</span> &amp;record;
00609     }
00610     
<a name="l00615"></a><a class="code" href="classdbCursor.html#dbCursora10">00615</a>     <span class="keywordtype">void</span> <a class="code" href="classdbCursor.html#dbCursora10">toArray</a>(<a class="code" href="classdbArray.html">dbArray</a>&lt; <a class="code" href="classdbReference.html">dbReference&lt;T&gt;</a> &gt;&amp; arr)<span class="keyword"> const </span>{ 
00616         arr.resize(selection.nRows);
00617         <a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a19">toArrayOfOid</a>((oid_t*)arr.base());
00618     }
00619 
<a name="l00624"></a><a class="code" href="classdbCursor.html#dbCursora11">00624</a>     <a class="code" href="classdbReference.html">dbReference&lt;T&gt;</a> <a class="code" href="classdbCursor.html#dbCursora11">currentId</a>()<span class="keyword"> const </span>{ 
00625         <span class="keywordflow">return</span> <a class="code" href="classdbReference.html">dbReference&lt;T&gt;</a>(currId);
00626     }
00627 
<a name="l00632"></a><a class="code" href="classdbCursor.html#dbCursora12">00632</a>     <span class="keywordtype">bool</span> <a class="code" href="classdbCursor.html#dbCursora12">isInSelection</a>(<a class="code" href="classdbReference.html">dbReference&lt;T&gt;</a>&amp; ref) {
00633         <span class="keywordflow">return</span> <a class="code" href="classdbAnyCursor.html#dbCursor_3_01dbTimeSeriesBlock_3_01T_01_4_01_4a46">dbAnyCursor::isInSelection</a>(ref.<a class="code" href="classdbAnyReference.html#dbReferencea13">getOid</a>());
00634     }
00635 };
00636 
00637 <span class="keyword">class </span>dbParallelQueryContext { 
00638   <span class="keyword">public</span>:
00639     <a class="code" href="classdbDatabase.html">dbDatabase</a>* <span class="keyword">const</span>      db;
00640     <a class="code" href="classdbCompiledQuery.html">dbCompiledQuery</a>* <span class="keyword">const</span> query;
00641     oid_t                  firstRow;
00642     <a class="code" href="classdbTable.html">dbTable</a>*               table;
00643     dbAnyCursor*           cursor;
00644     dbSelection            selection[dbMaxParallelSearchThreads];
00645 
00646     <span class="keywordtype">void</span> search(<span class="keywordtype">int</span> i); 
00647 
00648     dbParallelQueryContext(<a class="code" href="classdbDatabase.html">dbDatabase</a>* aDb, <a class="code" href="classdbTable.html">dbTable</a>* aTable, 
00649                            <a class="code" href="classdbCompiledQuery.html">dbCompiledQuery</a>* aQuery, dbAnyCursor* aCursor)
00650       : db(aDb), query(aQuery), firstRow(aTable-&gt;firstRow), table(aTable), cursor(aCursor) {}
00651 };
00652 
00653 
00654 <span class="keyword">extern</span> <span class="keywordtype">char</span>* strupper(<span class="keywordtype">char</span>* s);
00655 
00656 <span class="keyword">extern</span> <span class="keywordtype">char</span>* strlower(<span class="keywordtype">char</span>* s);
00657 
00658 END_FASTDB_NAMESPACE
00659 
00660 <span class="preprocessor">#endif</span>
</pre></div><hr><address style="align: right;"><small>Generated on Thu Feb 14 12:42:30 2008 for FastDB by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.18 </small></address>
</body>
</html>
