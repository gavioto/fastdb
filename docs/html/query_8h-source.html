<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>query.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>query.h</h1><div class="fragment"><pre>00001 <span class="comment">//-&lt; QUERY.H &gt;-------------------------------------------------------*--------*</span>
00002 <span class="comment">// FastDB                    Version 1.0         (c) 1999  GARRET    *     ?  *</span>
00003 <span class="comment">// (Main Memory Database Management System)                          *   /\|  *</span>
00004 <span class="comment">//                                                                   *  /  \  *</span>
00005 <span class="comment">//                          Created:     20-Nov-98    K.A. Knizhnik  * / [] \ *</span>
00006 <span class="comment">//                          Last update: 10-Dec-98    K.A. Knizhnik  * GARRET *</span>
00007 <span class="comment">//-------------------------------------------------------------------*--------*</span>
00008 <span class="comment">// Constructing and hashing database query statements</span>
00009 <span class="comment">//-------------------------------------------------------------------*--------*</span>
00010 
00011 <span class="preprocessor">#ifndef __QUERY_H__</span>
00012 <span class="preprocessor"></span><span class="preprocessor">#define __QUERY_H__</span>
00013 <span class="preprocessor"></span>
00014 BEGIN_FASTDB_NAMESPACE
00015 
<a name="l00019"></a><a class="code" href="classdbQueryElement.html">00019</a> <span class="keyword">class </span>FASTDB_DLL_ENTRY <a class="code" href="classdbQueryElement.html">dbQueryElement</a> { 
00020     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classdbQuery.html">dbQuery</a>;
00021     <span class="keyword">friend</span> <span class="keyword">class </span>dbCompiler;
00022     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classdbQueryExpression.html">dbQueryExpression</a>;
00023     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classdbQueryElementAllocator.html">dbQueryElementAllocator</a>;
00024     <span class="keyword">friend</span> <span class="keyword">class </span>dbCLI;
00025   <span class="keyword">public</span>:
00026     <span class="keyword">enum</span> ElementType { 
00027         qExpression, <span class="comment">// part of SQL expression</span>
00028         qVarBool,
00029         qVarInt1,
00030         qVarInt2,
00031         qVarInt4,
00032         qVarInt8,
00033         qVarReal4,
00034         qVarReal8,
00035         qVarString,
00036         qVarStringPtr,
00037         qVarReference,
00038         qVarRectangle, 
00039         qVarArrayOfRef, 
00040         qVarArrayOfInt4,
00041         qVarArrayOfInt8,
00042         qVarArrayOfRefPtr,
00043         qVarArrayOfInt4Ptr,
00044         qVarArrayOfInt8Ptr,
00045         qVarRawData,
00046 <span class="preprocessor">#ifdef USE_STD_STRING</span>
00047 <span class="preprocessor"></span>        qVarStdString,
00048 <span class="preprocessor">#endif</span>
00049 <span class="preprocessor"></span>        qVarUnknown
00050     };
00051     
00052     ElementType getType()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> type; }
00053     <a class="code" href="classdbQueryElement.html">dbQueryElement</a>* nextElement()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> next; }
00054 
00055     <span class="keywordtype">void</span>* operator new (size_t size EXTRA_DEBUG_NEW_PARAMS);
00056     <span class="keywordtype">void</span>  operator delete(<span class="keywordtype">void</span>* p EXTRA_DEBUG_NEW_PARAMS);
00057 
00058     <span class="keywordtype">char</span>* dump(<span class="keywordtype">char</span>* buf);
00059     <span class="keywordtype">char</span>* dumpValues(<span class="keywordtype">char</span>* buf);
00060 
00061     <a class="code" href="classdbQueryElement.html">dbQueryElement</a>(ElementType t, <span class="keywordtype">void</span> <span class="keyword">const</span>* p, 
00062                    <a class="code" href="classdbTableDescriptor.html">dbTableDescriptor</a>* table = NULL) 
00063     {
00064         type = t;
00065         ptr  = p;       
00066         ref  = table;
00067         next = NULL;
00068     } 
00069   <span class="keyword">private</span>:
00070     <a class="code" href="classdbQueryElement.html">dbQueryElement</a>*    next;
00071     <span class="keywordtype">void</span> <span class="keyword">const</span>*        ptr;
00072     ElementType        type;
00073     <a class="code" href="classdbTableDescriptor.html">dbTableDescriptor</a>* ref;
00074 };
00075 
00076 
<a name="l00082"></a><a class="code" href="classdbQueryElementAllocator.html">00082</a> <span class="keyword">class </span>FASTDB_DLL_ENTRY dbQueryElementAllocator { 
00083     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classdbDatabase.html">dbDatabase</a>;
00084 
00085     dbMutex         mutex;
00086     <a class="code" href="classdbQueryElement.html">dbQueryElement</a>* freeChain;
00087     
00088   <span class="keyword">public</span>:
00089     <span class="keywordtype">void</span> deallocate(<a class="code" href="classdbQueryElement.html">dbQueryElement</a>* first, <a class="code" href="classdbQueryElement.html">dbQueryElement</a>** lastNext) { 
00090         dbCriticalSection cs(mutex);
00091         <span class="keywordflow">if</span> (first != NULL) { 
00092             *lastNext = freeChain;
00093             freeChain = first;
00094         }
00095     }
00096         
00097     <span class="keywordtype">void</span>* allocate(size_t size);
00098 
00099     dbQueryElementAllocator();
00100     ~dbQueryElementAllocator();
00101 
00102     <span class="keyword">static</span> dbQueryElementAllocator instance;
00103 };
00104 
<a name="l00124"></a><a class="code" href="classdbComponent.html">00124</a> <span class="keyword">class </span>FASTDB_DLL_ENTRY dbComponent { 
00125   <span class="keyword">public</span>:
00126     <span class="keywordtype">char</span> <span class="keyword">const</span>* structure;
00127     <span class="keywordtype">char</span> <span class="keyword">const</span>* field; 
00128 
00129     dbComponent(<span class="keywordtype">char</span> <span class="keyword">const</span>* s, <span class="keywordtype">char</span> <span class="keyword">const</span>* f=NULL) : structure(s), field(f) {}
00130 };
00131 
00132 
<a name="l00139"></a><a class="code" href="classdbQueryExpression.html">00139</a> <span class="keyword">class </span>FASTDB_DLL_ENTRY dbQueryExpression { 
00140     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classdbQuery.html">dbQuery</a>;
00141     <a class="code" href="classdbQueryElement.html">dbQueryElement</a>*  first;
00142     <a class="code" href="classdbQueryElement.html">dbQueryElement</a>** last;
00143     <span class="keywordtype">bool</span>             operand;
00144 
00145   <span class="keyword">public</span>:
00146     dbQueryExpression&amp; add(dbQueryElement::ElementType type, <span class="keywordtype">void</span> <span class="keyword">const</span>* ptr, <a class="code" href="classdbTableDescriptor.html">dbTableDescriptor</a>* table = NULL) {
00147         last = &amp;(*last = <span class="keyword">new</span> <a class="code" href="classdbQueryElement.html">dbQueryElement</a>(type, ptr, table))-&gt;<a class="code" href="classdbQueryElement.html#dbQueryElemento0">next</a>;
00148         operand = (type == dbQueryElement::qExpression);
00149         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00150     }
00151         
00152     dbQueryExpression&amp; operator = (<span class="keywordtype">char</span> <span class="keyword">const</span>* ptr) { 
00153         first = NULL, last = &amp;first;
00154         <span class="keywordflow">return</span> add(dbQueryElement::qExpression, ptr);
00155     }
00156     dbQueryExpression&amp; operator = (dbComponent <span class="keyword">const</span>&amp; comp);
00157 
00158     dbQueryExpression&amp; operator = (dbQueryExpression <span class="keyword">const</span>&amp; expr);
00159 
00160     dbQueryExpression&amp; operator,(int1 <span class="keyword">const</span>&amp; ptr) { 
00161         <span class="keywordflow">return</span> add(dbQueryElement::qVarInt1, &amp;ptr);
00162     }
00163     dbQueryExpression&amp; operator,(int2 <span class="keyword">const</span>&amp; ptr) { 
00164         <span class="keywordflow">return</span> add(dbQueryElement::qVarInt2, &amp;ptr);
00165     }
00166     dbQueryExpression&amp; operator,(int4 <span class="keyword">const</span>&amp; ptr) { 
00167         <span class="keywordflow">return</span> add(dbQueryElement::qVarInt4, &amp;ptr);
00168     }
00169     dbQueryExpression&amp; operator,(db_int8 <span class="keyword">const</span>&amp; ptr) { 
00170         <span class="keywordflow">return</span> add(dbQueryElement::qVarInt8, &amp;ptr);
00171     }
00172     dbQueryExpression&amp; operator,(nat1 <span class="keyword">const</span>&amp; ptr) {
00173         <span class="keywordflow">return</span> add(dbQueryElement::qVarInt1, &amp;ptr);
00174     }
00175     dbQueryExpression&amp; operator,(nat2 <span class="keyword">const</span>&amp; ptr) {
00176         <span class="keywordflow">return</span> add(dbQueryElement::qVarInt2, &amp;ptr);
00177     }
00178     dbQueryExpression&amp; operator,(nat4 <span class="keyword">const</span>&amp; ptr) {
00179         <span class="keywordflow">return</span> add(dbQueryElement::qVarInt4, &amp;ptr);
00180     }
00181     dbQueryExpression&amp; operator,(db_nat8 <span class="keyword">const</span>&amp; ptr) {
00182         <span class="keywordflow">return</span> add(dbQueryElement::qVarInt8, &amp;ptr);
00183     }
00184 <span class="preprocessor">#if SIZEOF_LONG != 8</span>
00185 <span class="preprocessor"></span>    dbQueryExpression&amp; operator,(<span class="keywordtype">long</span> <span class="keyword">const</span>&amp; ptr) {
00186         <span class="keywordflow">return</span> add(dbQueryElement::qVarInt4, &amp;ptr);
00187     }
00188     dbQueryExpression&amp; operator,(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keyword">const</span>&amp; ptr) {
00189         <span class="keywordflow">return</span> add(dbQueryElement::qVarInt4, &amp;ptr);
00190     }
00191 <span class="preprocessor">#endif</span>
00192 <span class="preprocessor"></span>    dbQueryExpression&amp; operator,(real4 <span class="keyword">const</span>&amp; ptr) { 
00193         <span class="keywordflow">return</span> add(dbQueryElement::qVarReal4, &amp;ptr);
00194     }
00195     dbQueryExpression&amp; operator,(real8 <span class="keyword">const</span>&amp; ptr) { 
00196         <span class="keywordflow">return</span> add(dbQueryElement::qVarReal8, &amp;ptr);
00197     }
00198     dbQueryExpression&amp; operator,(<span class="keywordtype">bool</span> <span class="keyword">const</span>&amp; ptr) { 
00199         <span class="keywordflow">return</span> add(dbQueryElement::qVarBool, &amp;ptr);
00200     }
00201     dbQueryExpression&amp; operator,(<span class="keywordtype">char</span> <span class="keyword">const</span>* ptr) { 
00202         <span class="keywordflow">return</span> add(operand ? dbQueryElement::qVarString 
00203                    : dbQueryElement::qExpression, ptr);
00204     }
00205     dbQueryExpression&amp; operator,(<span class="keywordtype">char</span> <span class="keyword">const</span>** ptr) { 
00206         <span class="keywordflow">return</span> add(dbQueryElement::qVarStringPtr, ptr);
00207     }
00208     dbQueryExpression&amp; operator,(<span class="keywordtype">char</span>** ptr) { 
00209         <span class="keywordflow">return</span> add(dbQueryElement::qVarStringPtr, ptr);
00210     }
00211     dbQueryExpression&amp; operator,(<span class="keywordtype">void</span> <span class="keyword">const</span>* ptr) { 
00212         <span class="keywordflow">return</span> add(dbQueryElement::qVarRawData, ptr);
00213     }
00214     dbQueryExpression&amp; operator,(<a class="code" href="classrectangle.html">rectangle</a> <span class="keyword">const</span>&amp; rect) {
00215         <span class="keywordflow">return</span> add(dbQueryElement::qVarRectangle, &amp;rect);
00216     }
00217 <span class="preprocessor">#ifdef USE_STD_STRING</span>
00218 <span class="preprocessor"></span>    dbQueryExpression&amp; operator,(std::string <span class="keyword">const</span>&amp; str) {
00219         <span class="keywordflow">return</span> add(dbQueryElement::qVarStdString, &amp;str);
00220     }
00221 <span class="preprocessor">#endif</span>
00222 <span class="preprocessor"></span>    dbQueryExpression&amp; operator,(dbQueryExpression <span class="keyword">const</span>&amp; expr) { 
00223         *last = <span class="keyword">new</span> <a class="code" href="classdbQueryElement.html">dbQueryElement</a>(dbQueryElement::qExpression, <span class="stringliteral">"("</span>);
00224         (*last)-&gt;next = expr.<a class="code" href="classdbQueryExpression.html#dbQueryExpressiono0">first</a>;
00225         last = expr.<a class="code" href="classdbQueryExpression.html#dbQueryExpressiono1">last</a>;
00226         *last = <span class="keyword">new</span> <a class="code" href="classdbQueryElement.html">dbQueryElement</a>(dbQueryElement::qExpression, <span class="stringliteral">")"</span>);
00227         last = &amp;(*last)-&gt;<a class="code" href="classdbQueryElement.html#dbQueryElemento0">next</a>;
00228         operand = <span class="keyword">false</span>;
00229         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00230     }
00231     dbQueryExpression&amp; operator,(dbComponent <span class="keyword">const</span>&amp; comp) { 
00232         add(dbQueryElement::qExpression, comp.<a class="code" href="classdbComponent.html#dbComponentm0">structure</a>);
00233         <span class="keywordflow">if</span> (comp.<a class="code" href="classdbComponent.html#dbComponentm1">field</a> != NULL) { 
00234             add(dbQueryElement::qExpression, <span class="stringliteral">"."</span>);
00235             add(dbQueryElement::qExpression, comp.<a class="code" href="classdbComponent.html#dbComponentm1">field</a>);
00236         }
00237         operand = <span class="keyword">false</span>;
00238         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00239     }
00240     dbQueryExpression&amp; operator += (dbComponent <span class="keyword">const</span>&amp; comp) { 
00241         <span class="keywordflow">return</span> *<span class="keyword">this</span>,comp;
00242     }
00243     dbQueryExpression&amp; operator += (<span class="keywordtype">char</span> <span class="keyword">const</span>* ptr) { 
00244         <span class="keywordflow">return</span> add(dbQueryElement::qExpression, ptr);
00245     }
00246 <span class="preprocessor">#ifndef NO_MEMBER_TEMPLATES</span>
00247 <span class="preprocessor"></span>    <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
00248     dbQueryExpression&amp; operator,(<a class="code" href="classdbReference.html">dbReference&lt;T&gt;</a> <span class="keyword">const</span>&amp; value) { 
00249         <span class="keywordflow">return</span> add(dbQueryElement::qVarReference, &amp;value, &amp;T::dbDescriptor);
00250     }
00251 
00252     <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
00253     <span class="keyword">inline</span> dbQueryExpression&amp; operator,(<a class="code" href="classdbArray.html">dbArray</a>&lt; <a class="code" href="classdbReference.html">dbReference&lt;T&gt;</a> &gt; <span class="keyword">const</span>&amp; value) { 
00254         <span class="keywordflow">return</span> add(dbQueryElement::qVarArrayOfRef, &amp;value, &amp;T::dbDescriptor);
00255     }
00256 
00257     <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
00258     <span class="keyword">inline</span> dbQueryExpression&amp; operator,(<a class="code" href="classdbArray.html">dbArray</a>&lt; <a class="code" href="classdbReference.html">dbReference&lt;T&gt;</a> &gt;<span class="keyword">const</span>* <span class="keyword">const</span>&amp; value) { 
00259         <span class="keywordflow">return</span> add(dbQueryElement::qVarArrayOfRefPtr, &amp;value, &amp;T::dbDescriptor);
00260     }
00261 <span class="preprocessor">#endif</span>
00262 <span class="preprocessor"></span><span class="preprocessor">#if !defined(_MSC_VER) || _MSC_VER+0 &gt;= 1300</span>
00263 <span class="preprocessor"></span>    <span class="keyword">inline</span> dbQueryExpression&amp; operator,(<a class="code" href="classdbArray.html">dbArray&lt;db_int4&gt;</a> <span class="keyword">const</span>&amp; value) { 
00264         <span class="keywordflow">return</span> add(dbQueryElement::qVarArrayOfInt4, &amp;value);
00265     }
00266 
00267     <span class="keyword">inline</span> dbQueryExpression&amp; operator,(<a class="code" href="classdbArray.html">dbArray&lt;db_int4&gt;</a><span class="keyword">const</span>* <span class="keyword">const</span>&amp; value) { 
00268         <span class="keywordflow">return</span> add(dbQueryElement::qVarArrayOfInt4Ptr, &amp;value);
00269     }
00270 
00271     <span class="keyword">inline</span> dbQueryExpression&amp; operator,(<a class="code" href="classdbArray.html">dbArray&lt;db_int8&gt;</a> <span class="keyword">const</span>&amp; value) { 
00272         <span class="keywordflow">return</span> add(dbQueryElement::qVarArrayOfInt8, &amp;value);
00273     }
00274 
00275     <span class="keyword">inline</span> dbQueryExpression&amp; operator,(<a class="code" href="classdbArray.html">dbArray&lt;db_int8&gt;</a><span class="keyword">const</span>* <span class="keyword">const</span>&amp; value) { 
00276         <span class="keywordflow">return</span> add(dbQueryElement::qVarArrayOfInt8Ptr, &amp;value);
00277     }
00278 <span class="preprocessor">#endif</span>
00279 <span class="preprocessor"></span>};
00280 
00281 <span class="keyword">class </span>dbOrderByNode;
00282 <span class="keyword">class </span>dbFollowByNode;
00283 
00284 
<a name="l00288"></a><a class="code" href="classdbCompiledQuery.html">00288</a> <span class="keyword">class </span>FASTDB_DLL_ENTRY dbCompiledQuery { 
00289   <span class="keyword">public</span>:
00290     dbExprNode*        tree;
00291     dbOrderByNode*     order;
00292     dbFollowByNode*    follow;
00293     <a class="code" href="classdbTableDescriptor.html">dbTableDescriptor</a>* table;
00294     <span class="keywordtype">int</span>                schemeVersion;
00295 
00296     size_t             stmtLimitStart;
00297     size_t             stmtLimitLen;
00298     int4*              stmtLimitStartPtr;
00299     int4*              stmtLimitLenPtr;
00300     <span class="keywordtype">bool</span>               limitSpecified;
00301 
00302     <span class="keyword">enum</span> IteratorInit { 
00303         StartFromAny,
00304         StartFromFirst,
00305         StartFromLast,
00306         StartFromRef, 
00307         StartFromArray,
00308         StartFromArrayPtr
00309     };
00310     IteratorInit       startFrom;
00311     <span class="keywordtype">void</span> <span class="keyword">const</span>*        root;
00312 
00313     <span class="keywordtype">void</span> destroy();
00314 
00315     <span class="keywordtype">bool</span> compiled() { <span class="keywordflow">return</span> tree != NULL; }
00316 
00317     <span class="keywordtype">bool</span> compileError() { <span class="keywordflow">return</span> !compiled(); }
00318 
00319     dbCompiledQuery() { 
00320         tree = NULL;
00321         order = NULL;
00322         follow = NULL;
00323         table = NULL;
00324         startFrom = StartFromAny;
00325         limitSpecified = <span class="keyword">false</span>;
00326     }
00327 };
00328 
<a name="l00333"></a><a class="code" href="classdbQuery.html">00333</a> <span class="keyword">class </span>FASTDB_DLL_ENTRY dbQuery : <span class="keyword">public</span> dbCompiledQuery { 
00334     <span class="keyword">friend</span> <span class="keyword">class </span>dbCompiler;
00335     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classdbDatabase.html">dbDatabase</a>;
00336     <span class="keyword">friend</span> <span class="keyword">class </span>dbSubSql;
00337     <span class="keyword">friend</span> <span class="keyword">class </span>dbCLI;
00338   <span class="keyword">private</span>:
00339     dbMutex            mutex;
00340     <a class="code" href="classdbQueryElement.html">dbQueryElement</a>*    elements;
00341     <a class="code" href="classdbQueryElement.html">dbQueryElement</a>**   nextElement;
00342     <span class="keywordtype">bool</span>               operand;
00343     <span class="keywordtype">bool</span>               mutexLocked;
00344 
00345     <span class="comment">//</span>
00346     <span class="comment">// Prohibite query copying</span>
00347     <span class="comment">//</span>
00348     dbQuery(dbQuery <span class="keyword">const</span>&amp;) : dbCompiledQuery() {} 
00349     dbQuery&amp; operator =(dbQuery <span class="keyword">const</span>&amp;) { <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
00350 
00351   <span class="keyword">public</span>:
00352     <span class="keywordtype">int</span>                pos; <span class="comment">// position of condition in statement</span>
00353 
00354 
00355     <span class="keywordtype">char</span>* dump(<span class="keywordtype">char</span>* buf) { 
00356         <span class="keywordtype">char</span>* p = buf;
00357         <span class="keywordflow">for</span> (<a class="code" href="classdbQueryElement.html">dbQueryElement</a>* elem = elements; elem != NULL; elem = elem-&gt;<a class="code" href="classdbQueryElement.html#dbQueryElemento0">next</a>) { 
00358             p = elem-&gt;<a class="code" href="classdbQueryElement.html#dbQueryElementa4">dump</a>(p);
00359         }
00360         <span class="keywordflow">return</span> buf;
00361     }
00362 
00363     <span class="keywordtype">char</span>* dumpValues(<span class="keywordtype">char</span>* buf) { 
00364         <span class="keywordtype">char</span>* p = buf;
00365         <span class="keywordflow">for</span> (<a class="code" href="classdbQueryElement.html">dbQueryElement</a>* elem = elements; elem != NULL; elem = elem-&gt;<a class="code" href="classdbQueryElement.html#dbQueryElemento0">next</a>) { 
00366             p = elem-&gt;<a class="code" href="classdbQueryElement.html#dbQueryElementa5">dumpValues</a>(p);
00367         }
00368         <span class="keywordflow">return</span> buf;
00369     }
00370 
00371     dbQuery&amp; append(dbQueryElement::ElementType type, <span class="keywordtype">void</span> <span class="keyword">const</span>* ptr,
00372                     <a class="code" href="classdbTableDescriptor.html">dbTableDescriptor</a>* table = NULL) 
00373     { 
00374         nextElement = &amp;(*nextElement=<span class="keyword">new</span> <a class="code" href="classdbQueryElement.html">dbQueryElement</a>(type,ptr,table))-&gt;<a class="code" href="classdbQueryElement.html#dbQueryElemento0">next</a>;
00375         operand = (type == dbQueryElement::qExpression);
00376         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00377     }
00378 
00379     dbQuery&amp; reset();
00380 
00381     <span class="comment">//</span>
00382     <span class="comment">// Redefined operator = and , make it possible to specify query in the</span>
00383     <span class="comment">// following way:</span>
00384     <span class="comment">//         int x, y;</span>
00385     <span class="comment">//         dbDataTime dt;</span>
00386     <span class="comment">//         dbQuery q; </span>
00387     <span class="comment">//         dbCursor&lt;record&gt; cursor;</span>
00388     <span class="comment">//         q = "x=",x,"and y=",y,"and",dt == "date";</span>
00389     <span class="comment">//         for (x = 0; x &lt; max_x; x++) { </span>
00390     <span class="comment">//             for (y = 0; y &lt; max_y; y++) { </span>
00391     <span class="comment">//                 cursor.select(q);</span>
00392     <span class="comment">//                 ...</span>
00393     <span class="comment">//             }</span>
00394     <span class="comment">//         }</span>
00395 
00396     dbQuery&amp; add(dbQueryExpression <span class="keyword">const</span>&amp; expr); 
00397 
00398     dbQuery&amp; And(dbQueryExpression <span class="keyword">const</span>&amp; expr) { 
00399         <span class="keywordflow">if</span> (elements != NULL) { 
00400             append(dbQueryElement::qExpression, <span class="stringliteral">"and"</span>);
00401         }
00402         <span class="keywordflow">return</span> add(expr);
00403     }
00404 
00405     dbQuery&amp; Or(dbQueryExpression <span class="keyword">const</span>&amp; expr) { 
00406         <span class="keywordflow">if</span> (elements != NULL) { 
00407             append(dbQueryElement::qExpression, <span class="stringliteral">"or"</span>);
00408         }
00409         <span class="keywordflow">return</span> add(expr);
00410     }
00411 
00412     dbQuery&amp; And(<span class="keywordtype">char</span> <span class="keyword">const</span>* str) { 
00413         <span class="keywordflow">if</span> (elements != NULL) { 
00414             append(dbQueryElement::qExpression, <span class="stringliteral">"and"</span>);
00415         }
00416         <span class="keywordflow">return</span> append(dbQueryElement::qExpression, str);
00417     }
00418 
00419     dbQuery&amp; Or(<span class="keywordtype">char</span> <span class="keyword">const</span>* str) { 
00420         <span class="keywordflow">if</span> (elements != NULL) { 
00421             append(dbQueryElement::qExpression, <span class="stringliteral">"or"</span>);
00422         }
00423         <span class="keywordflow">return</span> append(dbQueryElement::qExpression, str);
00424     }
00425 
00426     dbQuery&amp; add(<span class="keywordtype">char</span> <span class="keyword">const</span>* str) { 
00427         <span class="keywordflow">return</span> append(operand ? dbQueryElement::qVarString 
00428                       : dbQueryElement::qExpression, str);
00429     }
00430     dbQuery&amp; add(<span class="keywordtype">char</span> <span class="keyword">const</span>** str) { 
00431         <span class="keywordflow">return</span> append(dbQueryElement::qVarStringPtr, str);
00432     }
00433     dbQuery&amp; add(<a class="code" href="classrectangle.html">rectangle</a> <span class="keyword">const</span>&amp; rect) {
00434         <span class="keywordflow">return</span> append(dbQueryElement::qVarRectangle, &amp;rect);
00435     }
00436 <span class="preprocessor">#ifdef USE_STD_STRING</span>
00437 <span class="preprocessor"></span>    dbQuery&amp; add(std::string <span class="keyword">const</span>&amp; str) { 
00438         <span class="keywordflow">return</span> append(dbQueryElement::qVarStdString, &amp;str);
00439     }
00440     dbQuery&amp; operator,(std::string <span class="keyword">const</span>&amp; str) { <span class="keywordflow">return</span> add(str); }
00441 <span class="preprocessor">#endif</span>
00442 <span class="preprocessor"></span>    dbQuery&amp; add(<span class="keywordtype">char</span>** str) { 
00443         <span class="keywordflow">return</span> append(dbQueryElement::qVarStringPtr, str);
00444     }
00445     dbQuery&amp; add(int1 <span class="keyword">const</span>&amp; value) { 
00446         <span class="keywordflow">return</span> append(dbQueryElement::qVarInt1, &amp;value);
00447     }
00448     dbQuery&amp; add (int2 <span class="keyword">const</span>&amp; value) { 
00449         <span class="keywordflow">return</span> append(dbQueryElement::qVarInt2, &amp;value);
00450     }
00451     dbQuery&amp; add (int4 <span class="keyword">const</span>&amp; value) { 
00452         <span class="keywordflow">return</span> append(dbQueryElement::qVarInt4, &amp;value);
00453     }
00454     dbQuery&amp; add (db_int8 <span class="keyword">const</span>&amp; value) { 
00455         <span class="keywordflow">return</span> append(dbQueryElement::qVarInt8, &amp;value);
00456     }
00457     dbQuery&amp; add(nat1 <span class="keyword">const</span>&amp; value) {
00458         <span class="keywordflow">return</span> append(dbQueryElement::qVarInt1, &amp;value);
00459     }
00460     dbQuery&amp; add (nat2 <span class="keyword">const</span>&amp; value) {
00461         <span class="keywordflow">return</span> append(dbQueryElement::qVarInt2, &amp;value);
00462     }
00463     dbQuery&amp; add (nat4 <span class="keyword">const</span>&amp; value) {
00464         <span class="keywordflow">return</span> append(dbQueryElement::qVarInt4, &amp;value);
00465     }
00466     dbQuery&amp; add (db_nat8 <span class="keyword">const</span>&amp; value) {
00467         <span class="keywordflow">return</span> append(dbQueryElement::qVarInt8, &amp;value);
00468     }
00469 <span class="preprocessor">#if SIZEOF_LONG != 8</span>
00470 <span class="preprocessor"></span>    dbQuery&amp; add (<span class="keywordtype">long</span> <span class="keyword">const</span>&amp; value) {
00471         <span class="keywordflow">return</span> append(dbQueryElement::qVarInt4, &amp;value);
00472     }
00473     dbQuery&amp; add (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keyword">const</span>&amp; value) {
00474         <span class="keywordflow">return</span> append(dbQueryElement::qVarInt4, &amp;value);
00475     }
00476 <span class="preprocessor">#endif</span>
00477 <span class="preprocessor"></span>    dbQuery&amp; add (real4 <span class="keyword">const</span>&amp; value) { 
00478         <span class="keywordflow">return</span> append(dbQueryElement::qVarReal4, &amp;value);
00479     }
00480     dbQuery&amp; add(real8 <span class="keyword">const</span>&amp; value) { 
00481         <span class="keywordflow">return</span> append(dbQueryElement::qVarReal8, &amp;value);
00482     }
00483     dbQuery&amp; add(<span class="keywordtype">bool</span> <span class="keyword">const</span>&amp; value) { 
00484         <span class="keywordflow">return</span> append(dbQueryElement::qVarBool, &amp;value);
00485     }
00486     dbQuery&amp; add(<span class="keywordtype">void</span> <span class="keyword">const</span>* value) { 
00487         <span class="keywordflow">return</span> append(dbQueryElement::qVarRawData, value);
00488     }
00489 
00490     dbQuery&amp; operator,(<span class="keywordtype">char</span> <span class="keyword">const</span>*  value) { <span class="keywordflow">return</span> add(value); }
00491     dbQuery&amp; operator,(<span class="keywordtype">char</span> <span class="keyword">const</span>** value) { <span class="keywordflow">return</span> add(value); }
00492     dbQuery&amp; operator,(<span class="keywordtype">char</span>** value) { <span class="keywordflow">return</span> add(value); }
00493     dbQuery&amp; operator,(int1 <span class="keyword">const</span>&amp;  value) { <span class="keywordflow">return</span> add(value); }
00494     dbQuery&amp; operator,(int2 <span class="keyword">const</span>&amp;  value) { <span class="keywordflow">return</span> add(value); }
00495     dbQuery&amp; operator,(int4 <span class="keyword">const</span>&amp;  value) { <span class="keywordflow">return</span> add(value); }
00496     dbQuery&amp; operator,(db_int8 <span class="keyword">const</span>&amp;  value) { <span class="keywordflow">return</span> add(value); }
00497     dbQuery&amp; operator,(nat1 <span class="keyword">const</span>&amp;  value) { <span class="keywordflow">return</span> add(value); }
00498     dbQuery&amp; operator,(nat2 <span class="keyword">const</span>&amp;  value) { <span class="keywordflow">return</span> add(value); }
00499     dbQuery&amp; operator,(nat4 <span class="keyword">const</span>&amp;  value) { <span class="keywordflow">return</span> add(value); }
00500     dbQuery&amp; operator,(db_nat8 <span class="keyword">const</span>&amp;  value) { <span class="keywordflow">return</span> add(value); }
00501 <span class="preprocessor">#if SIZEOF_LONG != 8</span>
00502 <span class="preprocessor"></span>    dbQuery&amp; operator,(<span class="keywordtype">long</span> <span class="keyword">const</span>&amp;  value) { <span class="keywordflow">return</span> add(value); }
00503     dbQuery&amp; operator,(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keyword">const</span>&amp;  value) { <span class="keywordflow">return</span> add(value); }
00504 <span class="preprocessor">#endif</span>
00505 <span class="preprocessor"></span>    dbQuery&amp; operator,(real4 <span class="keyword">const</span>&amp; value) { <span class="keywordflow">return</span> add(value); }
00506     dbQuery&amp; operator,(real8 <span class="keyword">const</span>&amp; value) { <span class="keywordflow">return</span> add(value); }
00507     dbQuery&amp; operator,(<span class="keywordtype">bool</span> <span class="keyword">const</span>&amp;  value) { <span class="keywordflow">return</span> add(value); }
00508     dbQuery&amp; operator,(<span class="keywordtype">void</span> <span class="keyword">const</span>*  value) { <span class="keywordflow">return</span> add(value); }
00509     dbQuery&amp; operator,(dbQueryExpression <span class="keyword">const</span>&amp; expr) { <span class="keywordflow">return</span> add(expr); }
00510     dbQuery&amp; operator,(<a class="code" href="classrectangle.html">rectangle</a> <span class="keyword">const</span>&amp; rect) { <span class="keywordflow">return</span> add(rect); }
00511 
00512     dbQuery&amp; operator = (<span class="keyword">const</span> <span class="keywordtype">char</span>* str) { 
00513         <span class="keywordflow">return</span> reset().<a class="code" href="classdbQuery.html#dbQuerya2">append</a>(dbQueryElement::qExpression, str);
00514     }
00515 
00516 <span class="preprocessor">#if !defined(_MSC_VER) || _MSC_VER+0 &gt;= 1300</span>
00517 <span class="preprocessor"></span>    <span class="keyword">inline</span> dbQuery&amp; operator,(<a class="code" href="classdbArray.html">dbArray&lt;db_int4&gt;</a> <span class="keyword">const</span>&amp; value) { 
00518         <span class="keywordflow">return</span> append(dbQueryElement::qVarArrayOfInt4, &amp;value);
00519     }
00520 
00521     <span class="keyword">inline</span> dbQuery&amp; operator,(<a class="code" href="classdbArray.html">dbArray&lt;db_int4&gt;</a><span class="keyword">const</span>* <span class="keyword">const</span>&amp; value) { 
00522         <span class="keywordflow">return</span> append(dbQueryElement::qVarArrayOfInt4Ptr, &amp;value);
00523     }
00524 
00525     <span class="keyword">inline</span> dbQuery&amp; operator,(<a class="code" href="classdbArray.html">dbArray&lt;db_int8&gt;</a> <span class="keyword">const</span>&amp; value) { 
00526         <span class="keywordflow">return</span> append(dbQueryElement::qVarArrayOfInt8, &amp;value);
00527     }
00528 
00529     <span class="keyword">inline</span> dbQuery&amp; operator,(<a class="code" href="classdbArray.html">dbArray&lt;db_int8&gt;</a><span class="keyword">const</span>* <span class="keyword">const</span>&amp; value) { 
00530         <span class="keywordflow">return</span> append(dbQueryElement::qVarArrayOfInt8Ptr, &amp;value);
00531     }
00532 
00533     <span class="keyword">inline</span> dbQuery&amp; add(<a class="code" href="classdbArray.html">dbArray&lt;db_int4&gt;</a> <span class="keyword">const</span>&amp; value) { 
00534         <span class="keywordflow">return</span> append(dbQueryElement::qVarArrayOfInt4, &amp;value);
00535     }
00536 
00537     <span class="keyword">inline</span> dbQuery&amp; add(<a class="code" href="classdbArray.html">dbArray&lt;db_int4&gt;</a><span class="keyword">const</span>* <span class="keyword">const</span>&amp; value) { 
00538         <span class="keywordflow">return</span> append(dbQueryElement::qVarArrayOfInt4Ptr, &amp;value);
00539     }
00540 
00541     <span class="keyword">inline</span> dbQuery&amp; add(<a class="code" href="classdbArray.html">dbArray&lt;db_int8&gt;</a> <span class="keyword">const</span>&amp; value) { 
00542         <span class="keywordflow">return</span> append(dbQueryElement::qVarArrayOfInt8, &amp;value);
00543     }
00544 
00545     <span class="keyword">inline</span> dbQuery&amp; add(<a class="code" href="classdbArray.html">dbArray&lt;db_int8&gt;</a><span class="keyword">const</span>* <span class="keyword">const</span>&amp; value) { 
00546         <span class="keywordflow">return</span> append(dbQueryElement::qVarArrayOfInt8Ptr, &amp;value);
00547     }
00548 <span class="preprocessor">#endif</span>
00549 <span class="preprocessor"></span>
00550 <span class="preprocessor">#ifndef NO_MEMBER_TEMPLATES</span>
00551 <span class="preprocessor"></span>    <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
00552     dbQuery&amp; operator,(<a class="code" href="classdbReference.html">dbReference&lt;T&gt;</a> <span class="keyword">const</span>&amp; value) { 
00553         <span class="keywordflow">return</span> append(dbQueryElement::qVarReference, &amp;value, &amp;T::dbDescriptor);
00554     }
00555 
00556     <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
00557     <span class="keyword">inline</span> dbQuery&amp; operator,(<a class="code" href="classdbArray.html">dbArray</a>&lt; <a class="code" href="classdbReference.html">dbReference&lt;T&gt;</a> &gt; <span class="keyword">const</span>&amp; value) { 
00558         <span class="keywordflow">return</span> append(dbQueryElement::qVarArrayOfRef, &amp;value, &amp;T::dbDescriptor);
00559     }
00560 
00561     <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
00562     <span class="keyword">inline</span> dbQuery&amp; operator,(<a class="code" href="classdbArray.html">dbArray</a>&lt; <a class="code" href="classdbReference.html">dbReference&lt;T&gt;</a> &gt;<span class="keyword">const</span>* <span class="keyword">const</span>&amp; value) { 
00563         <span class="keywordflow">return</span> append(dbQueryElement::qVarArrayOfRefPtr, &amp;value, &amp;T::dbDescriptor);
00564     }
00565 
00566     <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
00567     dbQuery&amp; add(<a class="code" href="classdbReference.html">dbReference&lt;T&gt;</a> <span class="keyword">const</span>&amp; value) { 
00568         <span class="keywordflow">return</span> append(dbQueryElement::qVarReference, &amp;value, &amp;T::dbDescriptor);
00569     }
00570 
00571     <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
00572     dbQuery&amp; add(<a class="code" href="classdbArray.html">dbArray</a>&lt; <a class="code" href="classdbReference.html">dbReference&lt;T&gt;</a> &gt; <span class="keyword">const</span>&amp; value) { 
00573         <span class="keywordflow">return</span> append(dbQueryElement::qVarArrayOfRef, &amp;value, &amp;T::dbDescriptor);
00574     }
00575     <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
00576     dbQuery&amp; add(<a class="code" href="classdbArray.html">dbArray</a>&lt; <a class="code" href="classdbReference.html">dbReference&lt;T&gt;</a> &gt;<span class="keyword">const</span>* <span class="keyword">const</span>&amp; value) { 
00577         <span class="keywordflow">return</span> append(dbQueryElement::qVarArrayOfRefPtr, &amp;value, &amp;T::dbDescriptor);
00578     }
00579 
00580     <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
00581     dbQuery&amp; operator = (T <span class="keyword">const</span>&amp; value) { 
00582         <span class="keywordflow">return</span> reset().<a class="code" href="classdbQuery.html#dbQuerya4">add</a>(value);
00583     }   
00584 <span class="preprocessor">#else</span>
00585 <span class="preprocessor"></span>    dbQuery&amp; operator = (dbQueryExpression <span class="keyword">const</span>&amp; expr) {
00586         <span class="keywordflow">return</span> reset().<a class="code" href="classdbQuery.html#dbQuerya4">add</a>(expr);
00587     }    
00588     dbQuery&amp; operator = (<a class="code" href="classrectangle.html">rectangle</a> <span class="keyword">const</span>&amp; expr) {
00589         <span class="keywordflow">return</span> reset().<a class="code" href="classdbQuery.html#dbQuerya4">add</a>(expr);
00590     }    
00591 <span class="preprocessor">#endif</span>
00592 <span class="preprocessor"></span>
00593 
00594     <a class="code" href="classdbQueryElement.html">dbQueryElement</a>* getElements()<span class="keyword"> const </span>{ 
00595         <span class="keywordflow">return</span> elements;
00596     }
00597 
00598     <span class="keywordtype">bool</span> isEmpty() { 
00599         <span class="keywordflow">return</span> elements == NULL 
00600             || (elements-&gt;<a class="code" href="classdbQueryElement.html#dbQueryElemento0">next</a> == NULL &amp;&amp; elements-&gt;<a class="code" href="classdbQueryElement.html#dbQueryElemento2">type</a> == dbQueryElement::qExpression &amp;&amp; *(<span class="keywordtype">char</span>*)elements-&gt;<a class="code" href="classdbQueryElement.html#dbQueryElemento1">ptr</a> == 0);
00601     }
00602 
00603     dbQuery() { 
00604         elements = NULL;
00605         nextElement = &amp;elements;
00606         operand = <span class="keyword">false</span>;
00607         pos = 0;
00608     } 
00609     dbQuery(<span class="keywordtype">char</span> <span class="keyword">const</span>* str) { 
00610         elements = <span class="keyword">new</span> <a class="code" href="classdbQueryElement.html">dbQueryElement</a>(dbQueryElement::qExpression, str);
00611         nextElement = &amp;elements-&gt;<a class="code" href="classdbQueryElement.html#dbQueryElemento0">next</a>;
00612         operand = <span class="keyword">true</span>;
00613         pos = 0;
00614     } 
00615     ~dbQuery() { 
00616         reset();
00617     }
00618 };
00619 
00620 <span class="preprocessor">#ifdef NO_MEMBER_TEMPLATES</span>
00621 <span class="preprocessor"></span><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
00622 <span class="keyword">inline</span> dbQueryExpression&amp; operator,(dbQueryExpression&amp; expr, <a class="code" href="classdbReference.html">dbReference&lt;T&gt;</a> <span class="keyword">const</span>&amp; value) { 
00623     <span class="keywordflow">return</span> expr.<a class="code" href="classdbQueryExpression.html#dbQueryExpressiona0">add</a>(dbQueryElement::qVarReference, &amp;value, &amp;T::dbDescriptor);
00624 }
00625 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
00626 <span class="keyword">inline</span> dbQueryExpression&amp; operator,(dbQueryExpression&amp; expr, <a class="code" href="classdbArray.html">dbArray</a>&lt; <a class="code" href="classdbReference.html">dbReference&lt;T&gt;</a> &gt; <span class="keyword">const</span>&amp; value) { 
00627     <span class="keywordflow">return</span> expr.<a class="code" href="classdbQueryExpression.html#dbQueryExpressiona0">add</a>(dbQueryElement::qVarArrayOfRef, &amp;value, 
00628                     &amp;T::dbDescriptor);
00629 }
00630 
00631 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
00632 <span class="keyword">inline</span> dbQueryExpression&amp; operator,(dbQueryExpression&amp; expr, <a class="code" href="classdbArray.html">dbArray</a>&lt; <a class="code" href="classdbReference.html">dbReference&lt;T&gt;</a> &gt;<span class="keyword">const</span>* <span class="keyword">const</span>&amp; value) { 
00633     <span class="keywordflow">return</span> expr.<a class="code" href="classdbQueryExpression.html#dbQueryExpressiona0">add</a>(dbQueryElement::qVarArrayOfRefPtr, &amp;value, &amp;T::dbDescriptor);
00634 }
00635 
00636 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
00637 <span class="keyword">inline</span> dbQuery&amp; operator,(dbQuery&amp; query, <a class="code" href="classdbReference.html">dbReference&lt;T&gt;</a> <span class="keyword">const</span>&amp; value) { 
00638     <span class="keywordflow">return</span> query.<a class="code" href="classdbQuery.html#dbQuerya2">append</a>(dbQueryElement::qVarReference, &amp;value, 
00639                         &amp;T::dbDescriptor);
00640 }
00641 
00642 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
00643 <span class="keyword">inline</span> dbQuery&amp; operator,(dbQuery&amp; query, 
00644                              <a class="code" href="classdbArray.html">dbArray</a>&lt; <a class="code" href="classdbReference.html">dbReference&lt;T&gt;</a> &gt; <span class="keyword">const</span>&amp; value) 
00645 { 
00646     <span class="keywordflow">return</span> query.<a class="code" href="classdbQuery.html#dbQuerya2">append</a>(dbQueryElement::qVarArrayOfRef, &amp;value, 
00647                         &amp;T::dbDescriptor);
00648 }
00649 
00650 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
00651 <span class="keyword">inline</span> dbQuery&amp; operator,(dbQuery&amp; query, 
00652                              <a class="code" href="classdbArray.html">dbArray</a>&lt; <a class="code" href="classdbReference.html">dbReference&lt;T&gt;</a> &gt;<span class="keyword">const</span>* <span class="keyword">const</span>&amp; value) 
00653 { 
00654     <span class="keywordflow">return</span> query.<a class="code" href="classdbQuery.html#dbQuerya2">append</a>(dbQueryElement::qVarArrayOfRefPtr, &amp;value, 
00655                         &amp;T::dbDescriptor);
00656 }
00657 
00658 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
00659 <span class="keyword">inline</span> dbQuery&amp; add(dbQuery&amp; query, <a class="code" href="classdbReference.html">dbReference&lt;T&gt;</a> <span class="keyword">const</span>&amp; value) { 
00660     <span class="keywordflow">return</span> query.<a class="code" href="classdbQuery.html#dbQuerya2">append</a>(dbQueryElement::qVarReference, &amp;value, &amp;T::dbDescriptor);
00661 }
00662 
00663 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
00664 <span class="keyword">inline</span> dbQuery&amp; add(dbQuery&amp; query, <a class="code" href="classdbArray.html">dbArray</a>&lt; <a class="code" href="classdbReference.html">dbReference&lt;T&gt;</a> &gt; <span class="keyword">const</span>&amp; value) { 
00665     <span class="keywordflow">return</span> query.<a class="code" href="classdbQuery.html#dbQuerya2">append</a>(dbQueryElement::qVarArrayOfRef, &amp;value, 
00666                         &amp;T::dbDescriptor);
00667 }
00668 
00669 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
00670 <span class="keyword">inline</span> dbQuery&amp; add(dbQuery&amp; query, <a class="code" href="classdbArray.html">dbArray</a>&lt; <a class="code" href="classdbReference.html">dbReference&lt;T&gt;</a> &gt;<span class="keyword">const</span>* <span class="keyword">const</span>&amp; value) { 
00671     <span class="keywordflow">return</span> query.<a class="code" href="classdbQuery.html#dbQuerya2">append</a>(dbQueryElement::qVarArrayOfRefPtr, &amp;value, &amp;T::dbDescriptor);
00672 }
00673 <span class="preprocessor">#endif</span>
00674 <span class="preprocessor"></span>
00675 <span class="preprocessor">#define USER_FUNC(f) static dbUserFunction f##_descriptor(&amp;f, (char*)#f)</span>
00676 <span class="preprocessor"></span>
00677 <span class="keyword">struct </span>dbInheritedAttribute;
00678 <span class="keyword">union  </span>dbSynthesizedAttribute;
00679 
<a name="l00684"></a><a class="code" href="classdbUserFunctionArgument.html">00684</a> <span class="keyword">class </span>FASTDB_DLL_ENTRY  dbUserFunctionArgument { 
00685   <span class="keyword">public</span>:
00686     <span class="keyword">enum</span> dbArgumentType { 
00687         atInteger, 
00688         atBoolean, 
00689         atString, 
00690         atReal, 
00691         atReference, 
00692         atRawBinary
00693     };  
00694     dbArgumentType type; 
00695     <span class="keyword">union </span>{
00696         real8       realValue;
00697         db_int8     intValue;
00698         <span class="keywordtype">bool</span>        boolValue;
00699         <span class="keywordtype">char</span> <span class="keyword">const</span>* strValue;
00700         oid_t       oidValue;
00701         <span class="keywordtype">void</span>*       rawValue;
00702     } u;
00703 
00704   <span class="keyword">private</span>:
00705     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classdbDatabase.html">dbDatabase</a>;
00706     dbUserFunctionArgument(dbExprNode*             expr, 
00707                            dbInheritedAttribute&amp;   iattr, 
00708                            dbSynthesizedAttribute&amp; sattr, 
00709                            <span class="keywordtype">int</span>                     i);
00710 };
00711 
<a name="l00720"></a><a class="code" href="classdbUserFunction.html">00720</a> <span class="keyword">class </span>FASTDB_DLL_ENTRY dbUserFunction { 
00721     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classdbDatabase.html">dbDatabase</a>;
00722     <span class="keyword">friend</span> <span class="keyword">class </span>dbCompiler;
00723 
00724     <span class="keywordtype">void</span>* fptr;
00725     <span class="keywordtype">char</span>* fname;
00726     
00727     dbUserFunction* next;
00728     <span class="keyword">static</span> dbUserFunction* list;
00729 
00730     <span class="keyword">enum</span> funcType {
00731         fInt2Bool,
00732         fReal2Bool,
00733         fStr2Bool,
00734         fInt2Int,
00735         fReal2Int,
00736         fStr2Int,
00737         fInt2Real,
00738         fReal2Real,
00739         fStr2Real,
00740         fInt2Str,
00741         fReal2Str,
00742         fStr2Str, 
00743         fArg2Bool, 
00744         fArg2Int, 
00745         fArg2Real, 
00746         fArg2Str, 
00747         fArgArg2Bool, 
00748         fArgArg2Int, 
00749         fArgArg2Real, 
00750         fArgArg2Str, 
00751         fArgArgArg2Bool, 
00752         fArgArgArg2Int, 
00753         fArgArgArg2Real, 
00754         fArgArgArg2Str
00755     };
00756     <span class="keywordtype">int</span> type;
00757 
00758     <span class="keywordtype">void</span> bind(<span class="keywordtype">char</span>* name, <span class="keywordtype">void</span>* f, funcType ftype);
00759 
00760   <span class="keyword">public</span>:
00761 
00762     <span class="keyword">static</span> dbUserFunction* find(<span class="keywordtype">char</span> <span class="keyword">const</span>* name) { 
00763         <span class="keywordflow">for</span> (dbUserFunction* func = list; func != NULL; func = func-&gt;<a class="code" href="classdbUserFunction.html#dbUserFunctiono2">next</a>) { 
00764             <span class="keywordflow">if</span> (name == func-&gt;<a class="code" href="classdbUserFunction.html#dbUserFunctiono1">fname</a>) { 
00765                 <span class="keywordflow">return</span> func;
00766             }
00767         }
00768         <span class="keywordflow">return</span> NULL;
00769     }
00770     
00771     <span class="keywordtype">int</span> getParameterType();
00772 
00773     <span class="keywordtype">int</span> getNumberOfParameters();
00774 
00775     dbUserFunction(<span class="keywordtype">bool</span> (*f)(db_int8), <span class="keywordtype">char</span>* name) { 
00776         bind(name, (<span class="keywordtype">void</span>*)f, fInt2Bool); 
00777     }
00778     dbUserFunction(<span class="keywordtype">bool</span> (*f)(real8), <span class="keywordtype">char</span>* name) { 
00779         bind(name, (<span class="keywordtype">void</span>*)f, fReal2Bool); 
00780     }
00781     dbUserFunction(<span class="keywordtype">bool</span> (*f)(<span class="keywordtype">char</span> <span class="keyword">const</span>*), <span class="keywordtype">char</span>* name) { 
00782         bind(name, (<span class="keywordtype">void</span>*)f, fStr2Bool); 
00783     }
00784     dbUserFunction(db_int8 (*f)(db_int8), <span class="keywordtype">char</span>* name) { 
00785         bind(name, (<span class="keywordtype">void</span>*)f, fInt2Int); 
00786     }
00787     dbUserFunction(db_int8 (*f)(real8), <span class="keywordtype">char</span>* name) { 
00788         bind(name, (<span class="keywordtype">void</span>*)f, fReal2Int); 
00789     }
00790     dbUserFunction(db_int8 (*f)(<span class="keywordtype">char</span> <span class="keyword">const</span>*), <span class="keywordtype">char</span>* name) { 
00791         bind(name, (<span class="keywordtype">void</span>*)f, fStr2Int); 
00792     }
00793     dbUserFunction(real8 (*f)(db_int8), <span class="keywordtype">char</span>* name) { 
00794         bind(name, (<span class="keywordtype">void</span>*)f, fInt2Real); 
00795     }
00796     dbUserFunction(real8 (*f)(real8), <span class="keywordtype">char</span>* name) { 
00797         bind(name, (<span class="keywordtype">void</span>*)f, fReal2Real); 
00798     }
00799     dbUserFunction(real8 (*f)(<span class="keywordtype">char</span> <span class="keyword">const</span>*), <span class="keywordtype">char</span>* name) { 
00800         bind(name, (<span class="keywordtype">void</span>*)f, fStr2Real); 
00801     }
00802     dbUserFunction(<span class="keywordtype">char</span>* (*f)(db_int8), <span class="keywordtype">char</span>* name) { 
00803         bind(name, (<span class="keywordtype">void</span>*)f, fInt2Str); 
00804     }
00805     dbUserFunction(<span class="keywordtype">char</span>* (*f)(real8), <span class="keywordtype">char</span>* name) { 
00806         bind(name, (<span class="keywordtype">void</span>*)f, fReal2Str); 
00807     }
00808     dbUserFunction(<span class="keywordtype">char</span>* (*f)(<span class="keywordtype">char</span> <span class="keyword">const</span>*), <span class="keywordtype">char</span>* name) { 
00809         bind(name, (<span class="keywordtype">void</span>*)f, fStr2Str); 
00810     }
00811 
00812 
00813     dbUserFunction(<span class="keywordtype">bool</span> (*f)(dbUserFunctionArgument&amp;), <span class="keywordtype">char</span>* name) { 
00814         bind(name, (<span class="keywordtype">void</span>*)f, fArg2Bool); 
00815     }
00816     dbUserFunction(<span class="keywordtype">char</span>* (*f)(dbUserFunctionArgument&amp;), <span class="keywordtype">char</span>* name) { 
00817         bind(name, (<span class="keywordtype">void</span>*)f, fArg2Str); 
00818     }
00819     dbUserFunction(db_int8 (*f)(dbUserFunctionArgument&amp;), <span class="keywordtype">char</span>* name) { 
00820         bind(name, (<span class="keywordtype">void</span>*)f, fArg2Int); 
00821     }
00822     dbUserFunction(real8 (*f)(dbUserFunctionArgument&amp;), <span class="keywordtype">char</span>* name) { 
00823         bind(name, (<span class="keywordtype">void</span>*)f, fArg2Real); 
00824     }
00825 
00826     dbUserFunction(<span class="keywordtype">bool</span> (*f)(dbUserFunctionArgument&amp;, dbUserFunctionArgument&amp;), <span class="keywordtype">char</span>* name) { 
00827         bind(name, (<span class="keywordtype">void</span>*)f, fArgArg2Bool); 
00828     }
00829     dbUserFunction(<span class="keywordtype">char</span>* (*f)(dbUserFunctionArgument&amp;, dbUserFunctionArgument&amp;), <span class="keywordtype">char</span>* name) { 
00830         bind(name, (<span class="keywordtype">void</span>*)f, fArgArg2Str); 
00831     }
00832     dbUserFunction(db_int8 (*f)(dbUserFunctionArgument&amp;, dbUserFunctionArgument&amp;), <span class="keywordtype">char</span>* name) { 
00833         bind(name, (<span class="keywordtype">void</span>*)f, fArgArg2Int); 
00834     }
00835     dbUserFunction(real8 (*f)(dbUserFunctionArgument&amp;, dbUserFunctionArgument&amp;), <span class="keywordtype">char</span>* name) { 
00836         bind(name, (<span class="keywordtype">void</span>*)f, fArgArg2Real); 
00837     }
00838 
00839 
00840     dbUserFunction(<span class="keywordtype">bool</span> (*f)(dbUserFunctionArgument&amp;, dbUserFunctionArgument&amp;, dbUserFunctionArgument&amp;), <span class="keywordtype">char</span>* name) { 
00841         bind(name, (<span class="keywordtype">void</span>*)f, fArgArgArg2Bool); 
00842     }
00843     dbUserFunction(<span class="keywordtype">char</span>* (*f)(dbUserFunctionArgument&amp;, dbUserFunctionArgument&amp;, dbUserFunctionArgument&amp;), <span class="keywordtype">char</span>* name) { 
00844         bind(name, (<span class="keywordtype">void</span>*)f, fArgArgArg2Str); 
00845     }
00846     dbUserFunction(db_int8 (*f)(dbUserFunctionArgument&amp;, dbUserFunctionArgument&amp;, dbUserFunctionArgument&amp;), <span class="keywordtype">char</span>* name) { 
00847         bind(name, (<span class="keywordtype">void</span>*)f, fArgArgArg2Int); 
00848     }
00849     dbUserFunction(real8 (*f)(dbUserFunctionArgument&amp;, dbUserFunctionArgument&amp;, dbUserFunctionArgument&amp;), <span class="keywordtype">char</span>* name) { 
00850         bind(name, (<span class="keywordtype">void</span>*)f, fArgArgArg2Real); 
00851     }
00852 
00853     ~dbUserFunction();
00854 };
00855 
00856 END_FASTDB_NAMESPACE
00857 
00858 <span class="preprocessor">#endif</span>
00859 <span class="preprocessor"></span>
00860 
00861 
</pre></div><hr><address style="align: right;"><small>Generated on Thu Feb 14 12:42:30 2008 for FastDB by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.18 </small></address>
</body>
</html>
